

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MARIGOLD.Condition &mdash; MARIGOLD 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=470960a4" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MARIGOLD
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Example Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MARIGOLD.html">MARIGOLD Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MARIGOLD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MARIGOLD.Condition</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MARIGOLD.Condition</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.plot_utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>


<div class="viewcode-block" id="Condition">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition">[docs]</a>
<span class="k">class</span> <span class="nc">Condition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Class to handle the local probe data</span>

<span class="sd">    Data is stored in the Condition.data property. It&#39;s actually 3 layers of dictionary</span>

<span class="sd">    ``cond.data[angle]`` gives a dictionary with the various r/R</span>

<span class="sd">    ``cond.data[angle][r/R]`` gives a dictionary with the MIDAS output (``midas_dict``)</span>

<span class="sd">    The MIDAS output is itself a dictionary, with the keys listed in the &quot;tab_keys&quot; array</span>
<span class="sd">    So data[angle][r/R][&#39;alpha&#39;] should give you the void fraction at r/R for phi = angle</span>
<span class="sd">    This structure is initialized with zeros for the MIDAS output at the pipe center and wall</span>

<span class="sd">    Can also get the data at a local point from calling the condition, syntax</span>

<span class="sd">    cond(phi, r, &#39;param&#39;). Phi is in radians, the arguments can be constants or numpy arrays.</span>
<span class="sd">    Also has an option for interpolation, &#39;interp_method&#39; </span>

<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">debugFID</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jgref</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">jgloc</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">jf</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">fluids</span> <span class="o">=</span> <span class="s1">&#39;air-water&#39;</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Condition object</span>

<span class="sd">        :param jgref: reference superficial gas velocity</span>
<span class="sd">        :type jgref: float</span>
<span class="sd">        :param jgloc: local superficial gas velocity</span>
<span class="sd">        :type jgloc: float</span>
<span class="sd">        :param jf: superficial liquid velocity</span>
<span class="sd">        :type jf: float</span>
<span class="sd">        :param theta: angle of inclination of flow direction (0° is horizontal, 90° is vertical upwards)</span>
<span class="sd">        :type theta: int</span>
<span class="sd">        :param port: string to denote the port</span>
<span class="sd">        :type port: str</span>
<span class="sd">        :param database: string to associate what database this data is from</span>
<span class="sd">        :type database: str</span>
<span class="sd">        :param fluids: what fluid pair to use as the gas and liquid, defaults to &#39;air-water&#39;</span>
<span class="sd">        :type fluids: str, optional</span>
<span class="sd">        :param g: gravitational acceleration. In case you&#39;re on Mars. MARIGOLD multiplies by sin(θ), defaults to 9.81</span>
<span class="sd">        :type g: float, optional</span>
<span class="sd">        :raises NotImplementedError: If unknown fluid pair is specified. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jgref</span> <span class="o">=</span> <span class="n">jgref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">=</span> <span class="n">jf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">=</span><span class="n">jgloc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>

         <span class="c1"># Check if port is one of the specified vertical downward ports after U-bend, set theta to -90 degree if true (Quan 10/25)</span>
        <span class="c1"># if self.port in {&quot;P5&quot;, &quot;P6&quot;, &quot;P7&quot;, &quot;P8&quot;, &quot;P9&quot;, &quot;P10&quot;}:</span>
        <span class="c1">#    self.theta = int(-90)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     self.theta = int(90)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;jf=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="si">}</span><span class="s2">_jgloc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">_theta=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="si">}</span><span class="s2">_port=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Data is stored in this phi array. 3 layers of dictionary</span>
        <span class="c1"># phi [angle] gives a dictionary with the various r/R</span>
        <span class="c1"># phi [angle][r/R] gives a dictionary with the MIDAS output</span>
        <span class="c1"># So phi[angle][r/R][&#39;alpha&#39;] should give you the void fraction at r/R for phi = angle</span>
        <span class="c1"># This structure is initialized with zeros for the MIDAS output at the pipe center and wall</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">361</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">)</span> <span class="c1"># HARDCODED 22.5 degree increments</span>
        <span class="c1">#self.phi = deepcopy(dict( zip(angles, deepcopy([ {0.0: dict( zip(tab_keys, [0]*len(tab_keys)) ), 1.0: dict(zip(tab_keys, [0]*len(tab_keys)) ) } ]) * len(angles)) ))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Flow regime variable. 0 is undefined, 1 is bubbly, etc.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span>

        <span class="k">if</span> <span class="s1">&#39;D&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="ow">and</span> <span class="s1">&#39;P&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Assume it&#39;s PITA</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mi">66</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P3&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mi">110</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P4&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">130.04</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P5&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">144.17</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P6&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">147.57</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P7&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">151.84</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P8&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">165.57</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P9&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">194.07</span>          
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="s1">&#39;P10&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="mf">230.07</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not determine port L/D for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vwvg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">void_cov</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">area_avg_void_sheet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;Ryan&#39;</span> <span class="ow">or</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;ryan&#39;</span> <span class="ow">or</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;adix&#39;</span> <span class="ow">or</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;neup&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">=</span> <span class="mf">0.0254</span> <span class="c1"># m, for Ryan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>

        <span class="k">elif</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;Kong&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">=</span> <span class="mf">0.1016</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span> <span class="o">=</span> <span class="s1">&#39;dotted&#39;</span>

        <span class="k">elif</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;Talley&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">=</span> <span class="mf">0.0381</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span> <span class="o">=</span> <span class="s1">&#39;dashed&#39;</span>

        <span class="k">elif</span> <span class="n">database</span> <span class="o">==</span> <span class="s1">&#39;Yadav&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">=</span> <span class="mf">0.0508</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;D&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span> <span class="o">=</span> <span class="s1">&#39;dashdot&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Could not determine Dh for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_type</span> <span class="o">=</span> <span class="s1">&#39;$?$&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>

        <span class="c1"># Empty dictionaries, filled when max or area avg is called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circ_seg_area_avgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grads_calced</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">fluids</span> <span class="o">==</span> <span class="s1">&#39;air-water&#39;</span> <span class="ow">or</span> <span class="n">fluids</span> <span class="o">==</span> <span class="s1">&#39;water-air&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">=</span> <span class="mi">998</span>       <span class="c1"># kg/m^3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span> <span class="o">=</span> <span class="mf">1.204</span>     <span class="c1"># kg/m^3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span> <span class="o">=</span> <span class="mf">0.001002</span>   <span class="c1"># Pa s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span> <span class="o">=</span> <span class="mf">0.01803e-3</span> <span class="c1"># Pa s</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.0728</span>    <span class="c1"># N/m</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fluids</span><span class="si">}</span><span class="s2"> not available, try &#39;air-water&#39;&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gz</span> <span class="o">=</span> <span class="n">g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">__o</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>

            <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">==</span> <span class="n">__o</span><span class="o">.</span><span class="n">jf</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgref</span> <span class="o">==</span> <span class="n">__o</span><span class="o">.</span><span class="n">jgref</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="n">__o</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">==</span> <span class="n">__o</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">==</span> <span class="n">__o</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi_in</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">r_in</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the value of param at (phi, r). Phi is in radians, r nondimensional</span>

<span class="sd">        :param phi_in: Array of :math:`\\varphi` points</span>
<span class="sd">        :type phi_in: np.ndarray</span>
<span class="sd">        :param r_in: _description_</span>
<span class="sd">        :type r_in: np.ndarray</span>
<span class="sd">        :param param: _description_</span>
<span class="sd">        :type param: str</span>
<span class="sd">        :param interp_method: _description_, defaults to &#39;None&#39;</span>
<span class="sd">        :type interp_method: str, optional</span>
<span class="sd">        :raises NameError: _description_</span>
<span class="sd">        :return: _description_</span>
<span class="sd">        :rtype: np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">phi_in</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Converting phi_in to np.ndarray&quot;</span><span class="p">)</span>
            <span class="n">phi_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phi_in</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r_in</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Converting r_in to np.ndarray&quot;</span><span class="p">)</span>
            <span class="n">r_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r_in</span><span class="p">)</span>

        
        <span class="k">if</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">param_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">r_in</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">phi_in</span><span class="o">.</span><span class="n">size</span><span class="p">))</span> <span class="c1"># To-do: check if r_in and phi_in actually exist</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r_in</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">phi_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phi_in</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">param_values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">phi_val</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)][</span><span class="n">r_val</span><span class="p">][</span><span class="n">param</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">r_val</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                <span class="n">param_values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                                <span class="k">raise</span> 
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># Probably input a single phi instead of an array</span>
                
                <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">phi_in</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)][</span><span class="nb">float</span><span class="p">(</span><span class="n">r_in</span><span class="p">)][</span><span class="n">param</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">param_values</span>
        
        <span class="k">elif</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;spline&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">(</span><span class="n">phi_in</span><span class="p">,</span> <span class="n">r_in</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">(</span><span class="n">uniform_rmesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phi_in</span><span class="p">,</span> <span class="n">r_in</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phi_in</span><span class="p">,</span> <span class="n">r_in</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_interp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phi_in</span><span class="p">,</span> <span class="n">r_in</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;linear_xy&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">phi_in</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r_in</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_xy_interp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">interp_method</span><span class="si">}</span><span class="s2"> not recognized. Accepted arguments are &#39;None&#39;, &#39;spline&#39;, &#39;linear&#39; or &#39;linear_xy&#39;&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Condition.pretty_print">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.pretty_print">[docs]</a>
    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_to_file</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">FID</span><span class="o">=</span><span class="n">debugFID</span><span class="p">,</span> <span class="n">mirror</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints out all the information in a Condition in a structured way </span>

<span class="sd">        Specifically, everything in the Condition.phi dictionary, which has angles</span>
<span class="sd">        and r/Rs.</span>

<span class="sd">        Can either print to a file (specified by FID) or to stdout. Option to mirror the </span>
<span class="sd">        data, if that hasn&#39;t already been done</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;jf = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="si">}</span><span class="se">\t</span><span class="s2">jg = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jgref</span><span class="si">}</span><span class="se">\t</span><span class="s2">theta = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">FID</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mirror</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">print_to_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">FID</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">FID</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">midas_output</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">FID</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">midas_output</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Condition.mirror">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.mirror">[docs]</a>
    <span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;sym90&#39;</span><span class="p">,</span> <span class="n">sym90</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axisym</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">uniform_rmesh</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">uniform_rmesh_fill</span> <span class="o">=</span> <span class="s1">&#39;interp&#39;</span><span class="p">,</span> <span class="n">force_remirror</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Mirrors data, so we have data for every angle</span>

<span class="sd">        :param method: method to use for mirroring. Options are &#39;sym90&#39;, &#39;axisym&#39;, and &#39;avg_axisym&#39;. Defaults to &#39;sym90&#39;</span>
<span class="sd">        :type method: str, optional</span>
<span class="sd">        :param sym90: overwrites method, for backwards compatibility, defaults to False</span>
<span class="sd">        :type sym90: bool, optional</span>
<span class="sd">        :param axisym: overwrites method, for backwards compatibility, defaults to False</span>
<span class="sd">        :type axisym: bool, optional</span>
<span class="sd">        :param uniform_rmesh: ensure every angle has data for every r/R point. Will linearly interpolate when data on either side is available. This only  considers the +r/R mesh, defaults to False</span>
<span class="sd">        :type uniform_rmesh: bool, optional</span>
<span class="sd">        :param force_remirror: Usually can only mirror once. This overrides that restriction, defaults to False</span>
<span class="sd">        :type force_remirror: bool, optional</span>

<span class="sd">        Saves:</span>
<span class="sd">         - original_mesh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Only ever call this function once</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_remirror</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># Have a record of actual measurement locations</span>

        <span class="c1"># First step is to find the phi angles that have data        </span>
        <span class="n">angles_with_data</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">rdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">midas_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="s1">&#39;num_spherical&#39;</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;num_spherical&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1894</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;num_cap&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">11</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">):</span>
                            <span class="c1"># this is dummy data, ignore</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;num_spherical&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">302</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ai_distorted&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.25</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">):</span>
                            <span class="c1"># this is dummy data, ignore</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;num_spherical&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">157</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ai_distorted&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.88</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">):</span>
                            <span class="c1"># this is dummy data, ignore</span>
                            <span class="k">continue</span>

                    <span class="n">angles_with_data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">rstar</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">angles_with_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">angles_with_data</span><span class="p">)</span>
        <span class="c1"># print(angles_with_data)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angles with data: &#39;</span><span class="p">,</span> <span class="n">angles_with_data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">num_angles_measured</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles_with_data</span><span class="p">)</span> <span class="c1"># the actual number of angles measured (r/R can be negative)</span>

        <span class="c1"># Next, take any negative values for the existing data and copy them to the </span>
        <span class="c1"># +180 phi angle (the complementary angle)</span>
        <span class="c1"># Also delete the negative data from the existing phi, so all angles only have postive entries</span>
        <span class="n">angles_to_add</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_rs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="mi">180</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">comp_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">comp_angle</span> <span class="o">&lt;=</span> <span class="mi">360</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">comp_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angles_to_add</span><span class="p">):</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">])</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">all_rs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">pass</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span> 

                <span class="c1"># There should always be data at r/R 0 so we can plot contours</span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span>  <span class="c1"># just in case</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">comp_angle</span><span class="p">:</span> <span class="p">{}})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)}</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
                

                <span class="n">angles_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_angle</span><span class="p">)</span>

        <span class="n">angles_with_data</span> <span class="o">+=</span> <span class="n">angles_to_add</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angles with data after comp_angle: &#39;</span><span class="p">,</span> <span class="n">angles_with_data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="mi">360</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">angles_with_data</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">):</span>
            <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mi">360</span><span class="p">:</span> <span class="p">{}})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">360</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
            <span class="n">angles_with_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>

        <span class="c1"># Now comes the actual mirroring step. Need data for every angle, incremements of 22.5° (self._angles)</span>
        <span class="k">if</span> <span class="n">sym90</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;sym90&#39;</span>
        <span class="k">elif</span> <span class="n">axisym</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;axisym&#39;</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;axisym&#39;</span><span class="p">:</span> 
            <span class="c1"># axisymmetric</span>
            <span class="c1"># Find the reference angle with the most data</span>
            <span class="n">ref_angle</span> <span class="o">=</span> <span class="n">angles_with_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># initial guess</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">ref_angle</span> <span class="o">=</span> <span class="n">angle</span>
            
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">]</span> <span class="p">)</span>
                
                <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">angle</span><span class="p">:</span> <span class="p">{}})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;avg_axisym&#39;</span><span class="p">:</span>
            <span class="c1"># print(&#39;avg_axisym&#39;)</span>
            <span class="c1"># Find a reference angle with a complement, replace all the data with the average of the two</span>
            <span class="n">ref_angle</span> <span class="o">=</span> <span class="n">angles_with_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># initial guess</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">180</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">ref_angle</span> <span class="o">=</span> <span class="n">angle</span>

            <span class="n">temp_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>
            <span class="n">comp_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="o">+</span><span class="mi">180</span><span class="p">])</span>
            <span class="n">avg_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>
            <span class="c1"># print(&#39;comp data&#39;, comp_data)</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">temp_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">avg_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rstar</span><span class="p">:</span> <span class="p">{}</span> <span class="p">})</span>
                <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">avg_data</span><span class="p">[</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="n">comp_data</span><span class="p">[</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="c1"># print(&#39;used avg data&#39;)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">avg_data</span><span class="p">[</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">avg_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">angle</span><span class="p">:</span> <span class="p">{}})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sym90&#39;</span><span class="p">:</span> 
            <span class="c1"># symmetric across the 90 degree line</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">:</span>

                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)}</span> <span class="c1"># Fine if this gets overwritten, just need to make sure there&#39;s some data at 0 for plotting</span>

                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="c1"># Quadrant I, should usually have data here, but if we don&#39;t, try to copy data from Q2</span>
                        <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2"> when mirroring </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, defaulting to 0s&quot;</span><span class="p">)</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)}</span>

                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                       <span class="c1"># Quadrant II, mirror from Quadrant I</span>
                        <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">270</span><span class="p">:</span>
                        <span class="c1"># Quadrant III, should be covered by the negative of Quadrant I</span>
                        <span class="c1"># But if we&#39;re here there&#39;s no data here. So make sure it&#39;s 0</span>
                        <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">540</span> <span class="o">-</span> <span class="n">angle</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data found for </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2"> when mirroring </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, defaulting to 0s&quot;</span><span class="p">)</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)}</span>

                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">270</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                        <span class="c1"># Quadrant IV, mirror from Quadrant III</span>
                        <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">540</span> <span class="o">-</span> <span class="n">angle</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>

                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
                        <span class="n">ref_angle</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ref_angle</span><span class="p">])</span>

                    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span> <span class="c1"># paranoia</span>
                    
                    <span class="c1"># Check if data exists at zero, and if not, just put some zero data in</span>
                    <span class="k">try</span><span class="p">:</span> 
                        <span class="n">dummy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span> <span class="c1"># just in case</span>
                    
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># Just in case</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">angle</span><span class="p">:</span> <span class="p">{}})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

            <span class="c1"># Check if data exists at zero, and if not, just put some zero data in</span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span> <span class="c1"># just in case</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No symmetry being assumed. But we still want data at every angle. If it doesn&#39;t exist, must be 0</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Filling in all angles without data as 0&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angles_with_data</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)}</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">360</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">angle</span><span class="p">:</span> <span class="p">{}})</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">uniform_rmesh</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">tab_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_interp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="c1">#print(all_rs)</span>
            <span class="c1"># Make sure all the angles have data for all the rpoints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_rs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_rs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_rs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="c1">#print(self.all_rs)</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_rs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c1"># This will break if there&#39;s data for 0.85 in some cases but not others</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">zero_data</span><span class="p">)})</span>
            
            <span class="c1"># so go through and interpolate the points where we have data on either side</span>
            <span class="c1"># for angle in self._angles:</span>
            <span class="c1">#     for i in range(len(self.all_rs) - 2):</span>
            <span class="c1">#         #print(angle, self.all_rs[i+1])</span>
            <span class="c1">#         if (self.data[angle][self.all_rs[i+2]][&#39;alpha&#39;] != 0) and (self.data[angle][self.all_rs[i]][&#39;alpha&#39;] != 0) and (self.data[angle][self.all_rs[i+1]][&#39;alpha&#39;] == 0):</span>
            <span class="c1">#             print(f&quot;Warning: interpolating data for {angle}°, {self.all_rs[i+1]} to maintain uniform r/R mesh&quot;)</span>
            <span class="c1">#             for param in tab_keys:</span>
            <span class="c1">#                 try:</span>

            <span class="c1">#                     x = self.all_rs[i+1]</span>
            <span class="c1">#                     x1 = self.all_rs[i+2]</span>
            <span class="c1">#                     y1 = self.data[angle][x1][param]</span>
            <span class="c1">#                     x2 = self.all_rs[i]</span>
            <span class="c1">#                     y2 = self.data[angle][x2][param]</span>

            <span class="c1">#                     interp = y1 + (y2-y1)/(x2-x1) * (x - x1)</span>
            <span class="c1">#                     self.data[angle][self.all_rs[i+1]][param] = interp</span>
                            
            <span class="c1">#                 except KeyError:</span>
            <span class="c1">#                     #print(f&quot;{param} not found for {angle}°, {self.all_rs[i+1]}&quot;)</span>
            <span class="c1">#                     continue</span>
                        
            <span class="c1">#             self.data[angle][self.all_rs[i+1]][&#39;roverR&#39;] = f&quot;interpolated, {angle}, {i+1}&quot;</span>
            <span class="c1">#         else:</span>
            <span class="c1">#             pass</span>
            <span class="c1">#             #print(f&quot;I&#39;m not interpolating for {angle}°, {self.all_rs[i+1]}&quot;)</span>


            <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">all_rs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">tab_keys</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">phi</span><span class="p">][</span><span class="n">r</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">uniform_rmesh_fill</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">phi</span><span class="p">][</span><span class="n">r</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="k">elif</span> <span class="n">uniform_rmesh_fill</span> <span class="o">==</span> <span class="s1">&#39;interp&#39;</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">phi</span><span class="p">][</span><span class="n">r</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error interpolating in unifrom rmesh, &quot;</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                            <span class="k">pass</span>

            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">tab_keys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_linear_interp</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="c1"># Because it was created without the filled-in data before</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># clean up nones</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: &#39;None&#39; value for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">. Setting to 0&quot;</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">param</span> <span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.add_mesh_points">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.add_mesh_points">[docs]</a>
    <span class="k">def</span> <span class="nf">add_mesh_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_points</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for adding additional r/R points</span>

<span class="sd">        Data linearly interpolated based on surrounding data (specifically using ``__call__`` at the ``(angle, r)`` location in question)</span>

<span class="sd">        :param r_points: List of r locations to add</span>
<span class="sd">        :type r_points: list</span>
<span class="sd">        :param suppress: _description_, defaults to False</span>
<span class="sd">        :type suppress: bool, optional</span>
<span class="sd">        :return: 1</span>
<span class="sd">        :rtype: _type_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">r_points</span><span class="p">:</span>
                <span class="n">temp_midas_data</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="n">r_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">r_keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="n">r_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]]</span>
                
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">temp_midas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span> <span class="p">)</span> <span class="p">))</span>
                    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">suppress</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        
                        <span class="n">temp_midas_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tab_keys</span><span class="p">,</span> <span class="n">temp_midas_data</span><span class="p">))}</span> <span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span></div>

    
<div class="viewcode-block" id="Condition.approx_vf">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.approx_vf">[docs]</a>
    <span class="k">def</span> <span class="nf">approx_vf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">overwrite_vf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for approximating :math:`v_{f}` with power-law relation. </span>

<span class="sd">        .. math:: v_{f, approx} = \\frac{(n+1)(2n+1)}{ (2n^{2})}  (j_{f} / (1- \\langle \\alpha \\rangle))  (1 - |r^{*}|)^{1/n}</span>
<span class="sd">        </span>
<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vf_approx&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;vf&#39;``, if it does not alread exist in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-averaged ``&#39;vf_approx&#39;``</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">vf_approx</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;vf&#39;</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;approx_vf: data found for </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">overwrite_vf</span><span class="p">:</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf&#39;</span><span class="p">:</span> <span class="n">vf_approx</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf&#39;</span><span class="p">:</span> <span class="n">vf_approx</span><span class="p">})</span>
                
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf_approx&#39;</span><span class="p">:</span> <span class="n">vf_approx</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vf_approx&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.approx_vg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.approx_vg">[docs]</a>
    <span class="k">def</span> <span class="nf">approx_vg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;vr&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">update_ug1</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for approximating :math:`v_{g}` with power-law relation. I don&#39;t think this makes sense</span>

<span class="sd">        .. math:: v_{g, approx} = \\frac{(n+1)(2n+1)}{ (2n^{2})}  (j_{g} / \\langle \\alpha \\rangle)  (1 - |r^{*}|)^{1/n}</span>

<span class="sd">        Methods:</span>
<span class="sd">         - power-law</span>
<span class="sd">         - vrmodel, </span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vg_approx&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;ug1&#39;``, if it does not alread exist in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-averaged ``&#39;vg_approx&#39;``</span>

<span class="sd">        If you have a lot of group II bubbles this functions&#39; no good</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;power-law&#39;</span><span class="p">:</span>
                    <span class="n">vg_approx</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;vrmodel&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;vr_model&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_vr_model</span><span class="p">()</span>
                    <span class="n">vg_approx</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf_approx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;vr&#39;</span><span class="p">:</span>
                    <span class="n">vg_approx</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                    <span class="n">vg_approx</span> <span class="o">=</span> <span class="n">method</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown method for approximating vg: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">update_ug1</span> <span class="ow">and</span> <span class="s1">&#39;ug1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ug1&#39;</span><span class="p">:</span> <span class="n">vg_approx</span><span class="p">})</span>
                
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vg_approx&#39;</span><span class="p">:</span> <span class="n">vg_approx</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vg_approx&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.approx_vf_Kong">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.approx_vf_Kong">[docs]</a>
    <span class="k">def</span> <span class="nf">approx_vf_Kong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for approximating :math:`v_{f}` from Kong. TODO </span>

<span class="sd">        Not currently implemented</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">vf_approx</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf&#39;</span><span class="p">:</span> <span class="n">vf_approx</span><span class="p">})</span>

        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.calc_vf_lee">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vf_lee">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vf_lee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate :math:`v_{f}`, :math:`j_{f}`, :math:`v_{r}` based on Lee et al. (2002) equation</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vf_lee&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;jf_lee&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;vr_lee&#39;`` in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average vf_lee</span>

<span class="sd">        Really a model proposed by Bosio and Malnes (1968)</span>

<span class="sd">        .. math:: v_{f} = \\frac{ 1 }{ \\sqrt{1 - \\alpha^{2} / 2} } * \\sqrt{ \\frac{ 2 \\Delta p }{K \\rho_{f}} } </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dp</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;delta_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6894.757</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Δp needed for cacluclation of vf_lee&quot;</span><span class="p">)</span>
                
                <span class="n">vf_lee</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dp</span> <span class="o">/</span> <span class="p">(</span><span class="n">K</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">))</span>
                
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf_lee&#39;</span><span class="p">:</span> <span class="n">vf_lee</span><span class="p">})</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;jf_lee&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span><span class="o">*</span> <span class="n">vf_lee</span><span class="p">})</span>
                
                <span class="n">vg</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">vr_lee</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vr_lee</span> <span class="o">=</span> <span class="n">vg</span> <span class="o">-</span> <span class="n">vf_lee</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr_lee&#39;</span><span class="p">:</span>  <span class="n">vr_lee</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vf_lee&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_vf_naive">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vf_naive">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vf_naive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate :math:`v_{f}`, :math:`j_{f}`, :math:`v_{r}` based on single-phase Pitot-tube equation</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vf_naive&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;jf_naive&#39;`` in midas_dict</span>
<span class="sd">         - ``&#39;vr_naive&#39;`` in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average ``&#39;vf_naive&#39;``</span>

<span class="sd">        Mathematically performing the operation </span>
<span class="sd">        .. math::  v_{f} = \\sqrt{ \\frac{ 2 \\Delta p }{ \\rho_{f}} } </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vf_naive</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf_naive&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dp</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;delta_p&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6894.757</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Δp needed for cacluclation of vf_naive&quot;</span><span class="p">)</span>
                    
                    <span class="n">vf_naive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mi">2</span><span class="o">*</span><span class="n">dp</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span>
                
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vf_naive&#39;</span><span class="p">:</span> <span class="n">vf_naive</span><span class="p">})</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;jf_naive&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span><span class="o">*</span> <span class="n">vf_naive</span><span class="p">})</span>
                
                <span class="n">vg</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">vg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">vr_naive</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vr_naive</span> <span class="o">=</span> <span class="n">vg</span> <span class="o">-</span> <span class="n">vf_naive</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr_naive&#39;</span><span class="p">:</span>  <span class="n">vr_naive</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vf_naive&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_vr">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vr">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating relative velocity. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - warn_approx, flag for warning if :math`v_r` is not found and function is approximating</span>

<span class="sd">        Note that if vg = 0, then this method says vr = 0. This will happen when no data is present,</span>
<span class="sd">        such as in the bottom of the pipe in horizontal, when this is not necessarily true.</span>

<span class="sd">        This method also assumes vg = ug1, so if group II bubbles are present this may not be accurate</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vr&#39;`` in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average vr</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">vf</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;approx&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">approx_vf</span><span class="p">()</span>
                        <span class="n">vf</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf_approx&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Approximating vf in calculating vr, since no data found&quot;</span><span class="p">)</span>
                        <span class="n">warn_approx</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">approx_vf</span><span class="p">()</span>
                    <span class="n">vf</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">vg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># should be the same as α = 0, could maybe switch this to that</span>
                    <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># this is an assumption, similar to void weighting</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vr</span> <span class="o">=</span> <span class="n">vg</span> <span class="o">-</span> <span class="n">vf</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">vr</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: vr already present for </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">°, but doesn&#39;t match subtraction. Will update and overwrite&quot;</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr&#39;</span><span class="p">:</span> <span class="n">vr</span><span class="p">})</span>
                    <span class="k">elif</span> <span class="n">quiet</span><span class="p">:</span>    
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr&#39;</span><span class="p">:</span> <span class="n">vr</span><span class="p">})</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr&#39;</span><span class="p">:</span> <span class="n">vr</span><span class="p">})</span>
                    

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_vr2">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vr2">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn_approx</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating relative velocity based on ug2. </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - warn_approx, flag for warning if :math`v_r` is not found and function is approximating</span>

<span class="sd">        Note that if vg2 = 0, then this method says vr2 = 0. This will happen when no data is present,</span>
<span class="sd">        such as in the bottom of the pipe in horizontal, when this is not necessarily true</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vr2&#39;`` in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average vr2</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vf</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">warn_approx</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Approximating vf in calculating vr, since no data found&quot;</span><span class="p">)</span>
                        <span class="n">warn_approx</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">approx_vf</span><span class="p">()</span>
                    <span class="n">vf</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug2&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">vg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># should be the same as α = 0, could maybe switch this to that</span>
                    <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># this is an assumption, similar to void weighting</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vr</span> <span class="o">=</span> <span class="n">vg</span> <span class="o">-</span> <span class="n">vf</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">vr</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: vr2 already present for </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">°, but doesn&#39;t match subtraction. Will update and overwrite&quot;</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr2&#39;</span><span class="p">:</span> <span class="n">vr</span><span class="p">})</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr2&#39;</span><span class="p">:</span> <span class="n">vr</span><span class="p">})</span>
                    

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr2&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Condition.calc_vgj">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vgj">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vgj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn_approx</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating :math:`V_{gj}`</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - warn_approx, flag for warning if :math:`V_{gj}` is not found and function is approximating</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``&#39;vgj&#39;`` in ``midas_dict``</span>
<span class="sd">         - ``&#39;j&#39;`` in ``midas_dict``</span>
<span class="sd">         - ``&#39;alpha_j&#39;`` in ``midas_dict``</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Void-weighted area-averaged Vgj</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dummy</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">warn_approx</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Approximating vf in calculating local j, since no data found&quot;</span><span class="p">)</span>
                        <span class="n">warn_approx</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">approx_vf</span><span class="p">()</span>
                
                <span class="n">j_local</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="n">vgj</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">j_local</span>
                <span class="n">alpha_j</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">j_local</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vgj&#39;</span><span class="p">:</span> <span class="n">vgj</span><span class="p">})</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;j&#39;</span><span class="p">:</span> <span class="n">j_local</span><span class="p">})</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;alpha_j&#39;</span><span class="p">:</span> <span class="n">alpha_j</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;vgj&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Condition.calc_grad">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_grad">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recalc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates gradient of param based on the data in self. </span>

<span class="sd">        Inputs:</span>
<span class="sd">         - &quot;param&quot;, string for local parameter to calculate the gradient of</span>
<span class="sd">        </span>
<span class="sd">        Stores:</span>
<span class="sd">         - grad\_&#39;param&#39;_r</span>
<span class="sd">         - grad\_&#39;param&#39;_phi</span>
<span class="sd">         - grad\_&#39;param&#39;_phinor</span>
<span class="sd">         - grad\_&#39;param&#39;_x</span>
<span class="sd">         - grad\_&#39;param&#39;_y</span>
<span class="sd">         - grad\_&#39;param&#39;_total</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area average grad\_&#39;param&#39;_total</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grads_calced</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">recalc</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grads_calced</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="n">grad_param_name</span> <span class="o">=</span> <span class="s1">&#39;grad_&#39;</span> <span class="o">+</span> <span class="n">param</span>

        <span class="n">phis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">phis</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">maxj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">phi_angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">rs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="c1">#print(rs)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: somehow we still have negative data.</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">phi_angle</span><span class="si">=}</span><span class="se">\t</span><span class="si">{</span><span class="n">rs</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">grad_r_param</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">param</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="n">param</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                
                
                <span class="n">j</span> <span class="o">=</span> <span class="n">phis</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phi_angle</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">maxj</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">hi_phi</span> <span class="o">=</span> <span class="n">phis</span><span class="p">[(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hi_phi</span> <span class="o">=</span> <span class="n">phis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># use 22.5</span>
                
                <span class="n">lo_phi</span> <span class="o">=</span> <span class="n">phis</span><span class="p">[(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span>

                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lo_phi</span> <span class="o">=</span> <span class="n">phis</span><span class="p">[(</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="p">]</span> <span class="c1"># use 347.5, not 360</span>
                    <span class="c1">#print(hi_phi, lo_phi)</span>

                <span class="c1"># print(phis[j], hi_phi, lo_phi)</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hi_phi</span><span class="p">][</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">param</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key error found when indexing </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> for hi. Likely a case of the data being zero for the adjacent point, setting to 0...&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">lo_phi</span><span class="p">][</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">param</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key error found when indexing </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2"> for lo. Likely a case of the data being zero for the adjacent point, setting to 0...&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">grad_phi_param</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">hi</span> <span class="o">-</span> <span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">hi_phi</span> <span class="o">-</span> <span class="n">lo_phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grad_phi_param</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># I guess? Shouldn&#39;t actually come up</span>

                <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span> <span class="p">}</span> <span class="p">)</span>
                <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phi&#39;</span><span class="p">:</span> <span class="n">grad_phi_param</span> <span class="p">}</span> <span class="p">)</span>
                <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phinor&#39;</span><span class="p">:</span> <span class="n">grad_phi_param</span><span class="o">*</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">}</span> <span class="p">)</span>

                <span class="k">if</span> <span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_y&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_phi_param</span> <span class="p">}</span> <span class="p">)</span>
                    <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_x&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">grad_phi_param</span> <span class="p">}</span> <span class="p">)</span>

                <span class="n">r_dict</span><span class="p">[</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_total&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span><span class="o">+</span><span class="n">grad_phi_param</span> <span class="p">}</span> <span class="p">)</span>
                
                
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># first point, also calculate derivative at 0, using grad_r_param</span>
                
                    <span class="c1"># x and y only a function of r, dψ/dφ = 0</span>
                    <span class="k">if</span> <span class="n">phi_angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># r_dict[0.0].update( {grad_param_name+&#39;_x&#39;: grad_r_param * np.cos(phi_angle) } )</span>
                        <span class="c1"># Copy to all other angles</span>
                        <span class="k">for</span> <span class="n">temp_angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">temp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_x&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="p">}</span> <span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">phi_angle</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="c1"># r_dict[0.0].update( {grad_param_name+&#39;_y&#39;: grad_r_param * np.sin(phi_angle) } )</span>
                        <span class="c1"># Copy to all other angles</span>
                        <span class="k">for</span> <span class="n">temp_angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">temp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_y&#39;</span><span class="p">:</span> <span class="n">grad_r_param</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_angle</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="p">}</span> <span class="p">)</span>


                    <span class="k">if</span> <span class="n">phi_angle</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                        <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span> <span class="o">+</span> <span class="mi">180</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span> <span class="o">-</span> <span class="mi">180</span>
                    
                    <span class="c1"># Want to average dψ/dr between current phi angle and complementary angle</span>

                    <span class="k">if</span> <span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">grad_r_param</span>
                        <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">grad_r_param</span><span class="p">}</span> <span class="p">)</span>

                    
                    <span class="k">if</span> <span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">][</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">grad_r_param</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">grad_r_param</span><span class="p">}</span> <span class="p">)</span>
                        
                    
                    <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phi&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span>     
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phi&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>

                    <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phinor&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span>     
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_phinor&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})</span>

                    <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="p">{</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_total&#39;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">])}</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">][</span><span class="mf">0.0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_total&#39;</span><span class="p">:</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">])</span> <span class="p">})</span>
                    

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">grad_param_name</span><span class="o">+</span><span class="s1">&#39;_total&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.fit_spline">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.fit_spline">[docs]</a>
    <span class="k">def</span> <span class="nf">fit_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits a RectBivariateSpline for the given param. </span>

<span class="sd">           Can access later with self.spline_interp[param]. Must specify the &#39;param&#39; to fit</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span> <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> already has a fit spline&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">(</span><span class="n">uniform_rmesh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">phi_unique</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">r_unique</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">phi_unique</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="c1"># TODO check for the 0.85 issue</span>
                <span class="n">r_unique</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>

        <span class="n">r_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">r_unique</span><span class="p">))</span>
        <span class="n">phi_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">phi_unique</span><span class="p">))</span>
        <span class="n">r_unique</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">phi_unique</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">phi_unique</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rstar</span> <span class="ow">in</span> <span class="n">r_unique</span><span class="p">:</span>
                <span class="c1">#print(angle, rstar, self.phi[angle][rstar][param])</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">])</span>

        <span class="c1">#print(r_unique, phi_unique)</span>

        <span class="n">Vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">phi_unique</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">r_unique</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="c1">#print(Vals)</span>

        <span class="c1">#print(phi_knots, r_knots)</span>
        <span class="n">spline_interpolant</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">phi_unique</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="n">r_unique</span><span class="p">,</span> <span class="n">Vals</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">spline_interpolant</span><span class="p">})</span>
        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.fit_linear_interp">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.fit_linear_interp">[docs]</a>
    <span class="k">def</span> <span class="nf">fit_linear_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">refit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes a LinearNDInterpolator for the given param. </span>
<span class="sd">        </span>
<span class="sd">            Access with self.linear_interp[param], phi in radians</span>

<span class="sd">            If the requested param does not exist for a given (r, phi), this fills in 0</span>
<span class="sd">             </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span> <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">refit</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> already has a linear interpolator&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rstar</span><span class="p">,</span> <span class="s2">&quot;has no &quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                        <span class="k">raise</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">)</span>
                    
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>        <span class="c1"># Temporary, figure this out later</span>

        <span class="n">linear_interpolant</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">rs</span><span class="p">)),</span> <span class="n">vals</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_interp</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">linear_interpolant</span><span class="p">})</span>

        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.fit_linear_xy_interp">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.fit_linear_xy_interp">[docs]</a>
    <span class="k">def</span> <span class="nf">fit_linear_xy_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Makes a LinearNDInterpolator for the given param in x y coords</span>
<span class="sd">        </span>
<span class="sd">        Can access  with self.linear_xy_interp[param]</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span> <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">if</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> already has a linear interpolator in xy space&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>
                <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">suppress</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rstar</span><span class="p">,</span> <span class="s2">&quot;has no &quot;</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

        <span class="n">linear_interpolant</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)),</span> <span class="n">vals</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_xy_interp</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">linear_interpolant</span><span class="p">})</span>

        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.sum">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.sum">[docs]</a>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Adds all values of param</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - ``param``, string of local parameter to sum</span>

<span class="sd">        Returns:</span>
<span class="sd">         - sum of the value of parameter at every point</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">total</span></div>

    
<div class="viewcode-block" id="Condition.max">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.max">[docs]</a>
    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return maximum value of param in the Condition</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find maximum of</span>
<span class="sd">         - recalc, if already calculated, will pull from dictionary instead of calculating unless this is true</span>

<span class="sd">        Returns:</span>
<span class="sd">         - maximum value of param</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">recalc</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxs</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="c1"># why waste time </span>
        <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="nb">max</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">rstar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span><span class="nb">max</span><span class="p">})</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">max</span><span class="p">)</span></div>


<div class="viewcode-block" id="Condition.max_loc">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.max_loc">[docs]</a>
    <span class="k">def</span> <span class="nf">max_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return location of maximum value of param</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find maximum of</span>

<span class="sd">        Returns:</span>
<span class="sd">         - r/R location of the maximum value of param</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="nb">max</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">rstar</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.min">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.min">[docs]</a>
    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">recalc</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">nonzero</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return minimum value of param in the Condition</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find minimum of</span>
<span class="sd">         - recalc, if already calculated, will pull from dictionary instead of calculating unless this is true</span>
<span class="sd">         - nonzero, if true, will exclude points with the param = 0 when finding the minimum</span>

<span class="sd">        Returns:</span>
<span class="sd">         - minimum value of param</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mins</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">recalc</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mins</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="c1"># why waste time </span>
        <span class="nb">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="k">if</span> <span class="n">nonzero</span> <span class="ow">and</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
                    <span class="nb">min</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">rstar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mins</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span><span class="nb">min</span><span class="p">})</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">min</span><span class="p">)</span></div>


<div class="viewcode-block" id="Condition.min_loc">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.min_loc">[docs]</a>
    <span class="k">def</span> <span class="nf">min_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return location of minimum value of param</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find minimum of</span>

<span class="sd">        Returns:</span>
<span class="sd">         - r/R location of the maximum value of param</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span>
                    <span class="nb">min</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">rstar</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.max_line_loc">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.max_line_loc">[docs]</a>
    <span class="k">def</span> <span class="nf">max_line_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return location of maximum value of param at a given angle</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find maximum of</span>
<span class="sd">         - angle, angle to search along</span>

<span class="sd">        Returns:</span>
<span class="sd">         - r/R location of the maximum value of param when :math:`\\varphi` = ``angle``</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                <span class="nb">max</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">rstar</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.max_line">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.max_line">[docs]</a>
    <span class="k">def</span> <span class="nf">max_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return maximum value of param at a given angle</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find maximum of</span>
<span class="sd">         - angle, angle to search along</span>

<span class="sd">        Returns:</span>
<span class="sd">         - maximum value of param when φ=angle</span>
<span class="sd">                          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                <span class="nb">max</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">rstar</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">max</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.find_hstar_pos">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.find_hstar_pos">[docs]</a>
    <span class="k">def</span> <span class="nf">find_hstar_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;max_dsm&#39;</span><span class="p">,</span> <span class="n">void_criteria</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the vertical distance from the top of the pipe to the bubble layer interface</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - method</span>
<span class="sd">         - void_criteria, used in some methods</span>
<span class="sd">        </span>
<span class="sd">        Methods for determining bubble layer interface</span>
<span class="sd">         - max_dsm</span>
<span class="sd">         - min_grad_y</span>
<span class="sd">         - max_grad_y</span>
<span class="sd">         - max_mag_grad_y</span>
<span class="sd">         - zero_void</span>
<span class="sd">         - percent_void, search down the phi = 90 line, find largest value of rstar where alpha &lt; min_void</span>
<span class="sd">         - Ryan_Ref, uses 1.3 - 1.57e-5 * Ref, proposed by Ryan (2022)</span>

<span class="sd">        Returns:</span>
<span class="sd">         - hstar</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max_dsm&#39;</span><span class="p">:</span>
            <span class="n">r_max</span><span class="p">,</span> <span class="n">phi_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_loc</span><span class="p">(</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">)</span>
            <span class="n">h_star</span><span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r_max</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_max</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h_star</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;min_grad_y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
            <span class="n">r_min</span><span class="p">,</span> <span class="n">phi_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_loc</span><span class="p">(</span><span class="s1">&#39;grad_alpha_y&#39;</span><span class="p">)</span>
            <span class="n">h_star</span><span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r_min</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h_star</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max_grad_y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
            <span class="n">r_min</span><span class="p">,</span> <span class="n">phi_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_loc</span><span class="p">(</span><span class="s1">&#39;grad_alpha_y&#39;</span><span class="p">)</span>
            <span class="n">h_star</span><span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r_min</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_min</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h_star</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max_mag_grad_y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">void_criteria</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c1">#TODO finish this</span>
            <span class="n">h_star</span><span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">roverRend</span>
            <span class="k">return</span> <span class="n">h_star</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;zero_void&#39;</span><span class="p">:</span>
            <span class="c1"># search down the phi = 90 line, find largest value of rstar where alpha &lt; min_void</span>
            <span class="n">roverRend</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_line_loc</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="n">max_void</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_line</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">void_criteria</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;</span> <span class="n">roverRend</span> <span class="ow">and</span> <span class="n">rstar</span> <span class="o">&lt;</span> <span class="n">max_loc</span><span class="p">:</span>
                        <span class="n">roverRend</span> <span class="o">=</span> <span class="n">rstar</span>
            
            <span class="k">if</span> <span class="n">roverRend</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># Didn&#39;t find it on the positive side</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">270</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">void_criteria</span><span class="p">:</span>
                        <span class="k">if</span> <span class="o">-</span><span class="n">rstar</span> <span class="o">&gt;</span> <span class="n">roverRend</span><span class="p">:</span>
                            <span class="n">roverRend</span> <span class="o">=</span> <span class="o">-</span><span class="n">rstar</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">=</span> <span class="n">roverRend</span>
            <span class="n">h_star</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span>
            <span class="k">return</span> <span class="n">h_star</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;percent_void&#39;</span><span class="p">:</span>
            <span class="c1"># search down the phi = 90 line, find largest value of rstar where alpha &lt; min_void</span>
            <span class="n">roverRend</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">max_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_line_loc</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="n">max_void</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_line</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_void</span> <span class="o">*</span> <span class="n">void_criteria</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;</span> <span class="n">roverRend</span> <span class="ow">and</span> <span class="n">rstar</span> <span class="o">&lt;</span> <span class="n">max_loc</span><span class="p">:</span>
                        <span class="n">roverRend</span> <span class="o">=</span> <span class="n">rstar</span>
            
            <span class="k">if</span> <span class="n">roverRend</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">180</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_void</span> <span class="o">*</span> <span class="n">void_criteria</span><span class="p">:</span>
                        <span class="k">if</span> <span class="o">-</span><span class="n">rstar</span> <span class="o">&gt;</span> <span class="n">roverRend</span><span class="p">:</span>
                            <span class="n">roverRend</span> <span class="o">=</span> <span class="o">-</span><span class="n">rstar</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">=</span> <span class="n">roverRend</span>
            <span class="n">h_star</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span>
            <span class="k">return</span> <span class="n">h_star</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Ryan_Ref&#39;</span><span class="p">:</span>
                        
            <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">=</span> <span class="mf">1.3</span> <span class="o">-</span> <span class="mf">1.57e-5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ref</span>
            <span class="n">h_star</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span>
            <span class="k">return</span> <span class="n">h_star</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid method for find_h_pos&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span></div>


<div class="viewcode-block" id="Condition.avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.avg">[docs]</a>
    <span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">include_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a basic average of a parameter, &quot;param&quot;</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to find average of</span>
<span class="sd">         - include_zero, if you want to include when param = 0 in average</span>

<span class="sd">        Returns:</span>
<span class="sd">         - average value of param</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">avg_param</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="k">if</span> <span class="n">include_zero</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">avg_param</span> <span class="o">+=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">avg_param</span> <span class="o">+=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">avg_param</span> <span class="o">/</span> <span class="n">count</span></div>

    
<div class="viewcode-block" id="Condition.check_param">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.check_param">[docs]</a>
    <span class="k">def</span> <span class="nf">check_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if a parameter is present in condition data. Ignores r/R = 1.0</span>

<span class="sd">        :param param: parameter to check</span>
<span class="sd">        :type param: str</span>
<span class="sd">        :param strict: Check each point. Otherwise, one value every angle is acceptable., defaults to True</span>
<span class="sd">        :type strict: bool, optional</span>
<span class="sd">        :return: True if param is present, false if not</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">points_to_add</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">param_in_angle</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                            <span class="n">points_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">rstar</span><span class="p">))</span>
                            <span class="k">pass</span> <span class="c1"># TODO add extra stuff if it doesn&#39;t exist at 1.0, it really shouldn&#39;t be a problem</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># return (False, rstar, angle)</span>
                            <span class="k">return</span> <span class="kc">False</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">param_in_angle</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">param_in_angle</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">strict</span><span class="p">):</span>
                <span class="c1"># return (False, rstar, angle)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    
<div class="viewcode-block" id="Condition.check_param_loc">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.check_param_loc">[docs]</a>
    <span class="k">def</span> <span class="nf">check_param_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Checks if a given parameter is present everywhere in midas_dict</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">rstar</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">()</span></div>


<div class="viewcode-block" id="Condition.area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the area-average of a parameter</span>

<span class="sd">        .. math:: \\langle \\psi \\rangle = \\frac{1}{A} \iint_A \\psi(r,\\varphi) r \,dr\,d\\varphi</span>
<span class="sd">        </span>
<span class="sd">        **Args**:</span>
<span class="sd">        </span>
<span class="sd">         - ``param``: ``midas_dict`` parameter to area-average. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``even_opt``: option for ``scipy.integrate.simpsons``. Defaults to &#39;first&#39;.</span>
<span class="sd">         - ``recalc``: if true, will recalculate area average. Defaults to True.</span>
<span class="sd">         - ``method``: method to area-average. Defaults to None.</span>

<span class="sd">             - ``legacy``, using the same method as the Excel spreadsheets</span>
<span class="sd">             - ``legacy_old``, actually what we use in spreadsheets, hardcoded values</span>
<span class="sd">             - None, will use ``scipy.integrate.simpsons``. Recommended option</span>
<span class="sd">        </span>
<span class="sd">        **Raises**:</span>
<span class="sd">        </span>
<span class="sd">         - ``KeyError``: if ``param`` not found</span>
<span class="sd">        </span>
<span class="sd">        **Returns**:</span>
<span class="sd">        </span>
<span class="sd">         - area-averaged value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Method for calculating the area-average of a parameter, &quot;param&quot;</span>
        
        <span class="c1"># Inputs:</span>
        <span class="c1">#  - param, string of local parameter to area-average</span>
        <span class="c1">#  - even_opt, passed to integration method</span>
        <span class="c1">#  - recalc, if area-average previously calculated, it was stored in a dictionary, and can just pull from there</span>

        <span class="c1"># Returns:</span>
        <span class="c1">#  - Area-averaged parameter, or None if the method failed</span>
        
        <span class="c1"># Uses Simpson&#39;s rule for integration, specifically scipy.integrate.simpsons</span>
        
        <span class="c1"># </span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">recalc</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="c1"># why waste time, if we already calculated this don&#39;t do it again</span>
        
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;legacy&#39;</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Mirroring in area-avg&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>    <span class="c1"># We already have 0</span>
                    <span class="k">continue</span>

                <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                            <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with:&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                
                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

                <span class="nb">vars</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>      <span class="c1"># I noticed too late that the list goes from r/R = 0 to 1, not the other way around</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>        <span class="c1"># Already wrote the actual Simpson&#39;s rule part, easier to just do this</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
                    <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;rs to integrate over </span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="s2"> must be the same length as params </span><span class="si">{</span><span class="nb">vars</span><span class="si">}</span><span class="s2">, occured at </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>

                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rs</span><span class="p">))</span>                <span class="c1"># r/R steps</span>

                <span class="n">la</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>      <span class="c1"># Simpson&#39;s Rule coefficient</span>
                    
                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                                <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">/</span> <span class="mi">2</span>
                                <span class="n">S</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                    
                    <span class="n">la</span> <span class="o">=</span> <span class="n">la</span> <span class="o">+</span> <span class="n">S</span>
                
                <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>

            <span class="n">I</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">param_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">I</span><span class="p">})</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;legacy_old&#39;</span><span class="p">:</span>
            <span class="c1"># There&#39;s definitely a more elegant way to do this, but I just want Talley&#39;s data to work for now</span>

            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Mirroring in area-avg&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mf">0.95</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="p">:</span>
                        <span class="n">S_1</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.95</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.90</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.90</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.85</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.80</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_2</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.8</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_3</span> <span class="o">=</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">S_1</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">S_2</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.90</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.9</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.8</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_3</span> <span class="o">=</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">param</span><span class="p">],</span>             <span class="c1"># Might be doubling up</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>

                    <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">S_1</span><span class="p">,</span> <span class="n">S_2</span><span class="p">,</span> <span class="n">S_3</span><span class="p">)))</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">I</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">param_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">I</span><span class="p">})</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have to integrate twice, once with resepect to r, again with respect to phi</span>
            <span class="c1"># Start with r</span>
            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Mirroring in area-avg&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># This should be unnecessary now with the new mirror, but it&#39;s not hurting anyone by being here</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                            <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">float</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">))</span> <span class="c1"># Floatify to avoid np inhomogeneous array issues</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with:&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                        <span class="c1">#if debug: print(angle, midas_dict, file=debugFID)</span>
                
                
                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
                    <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;rs to integrate over </span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="s2"> must be the same length as params </span><span class="si">{</span><span class="nb">vars</span><span class="si">}</span><span class="s2">, occured at </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
                    
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    <span class="c1">#I = 2 * np.pi</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">area_avgs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">param</span><span class="p">:</span> <span class="n">I</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.circ_segment_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.circ_segment_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">circ_segment_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">hstar</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">ngridr</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ngridphi</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">int_err</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the area-average of a parameter, &quot;param&quot; in some circular segment defined by :math:`h^*`</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - hstar, distance from the top of the pipe that defines circular segment</span>
<span class="sd">         - int_err, acceptable warning for integral error (passed to scipy.integrate.dblquad)</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-averaged parameter, or None if the method failed</span>
<span class="sd">        </span>
<span class="sd">        Uses scipy.integrate.dblquad. May be computationally expensive</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r_star</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_star</span><span class="p">)</span>
                <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_star</span><span class="p">)</span> <span class="c1"># Don&#39;t forget r dr dθ</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="o">*</span> <span class="n">r_star</span><span class="p">)</span> <span class="c1"># Don&#39;t forget r dr dθ</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r_star</span><span class="si">}</span><span class="s2">. Substituting NaN&quot;</span><span class="p">)</span>

        <span class="c1"># Set up interpolation</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>   

        <span class="n">interp</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">phis</span><span class="p">)),</span> <span class="n">vals</span><span class="p">)</span> <span class="c1"># TODO refactor to use __call__</span>

        <span class="c1"># To integrate, need to get the bounds. They&#39;re different depending on if h* &gt; 1</span>
        <span class="k">def</span> <span class="nf">lower_r_bound_pos</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">upper_r_bound_neg</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dumb_func</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span> <span class="c1"># For area integration</span>
            <span class="k">return</span> <span class="n">r</span>

        <span class="k">if</span> <span class="n">hstar</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">dumb_func</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">hstar</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">dumb_func</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.circ_segment_void_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.circ_segment_void_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">circ_segment_void_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">hstar</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">ngridr</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ngridphi</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">int_err</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the void-weighted area-average of a parameter, &quot;param&quot; in some circular segment defined by :math:`h^*`</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - hstar, distance from the top of the pipe that defines circular segment</span>
<span class="sd">         - int_err, acceptable warning for integral error (passed to scipy.integrate.dblquad)</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Void-weighted rea-averaged parameter, or None if the method failed</span>
<span class="sd">        </span>
<span class="sd">        Uses scipy.integrate.dblquad. May be computationally expensive</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r_star</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_star</span><span class="p">)</span>
                <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
                <span class="n">denom</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_star</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_star</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="c1"># Don&#39;t forget r dr dθ</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span> <span class="o">*</span> <span class="n">r_star</span><span class="p">)</span> <span class="c1"># Don&#39;t forget r dr dθ</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r_star</span><span class="si">}</span><span class="s2">. Substituting NaN&quot;</span><span class="p">)</span>

        <span class="c1"># Set up interpolation</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>   
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>   

        <span class="n">interp</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">phis</span><span class="p">)),</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">interp2</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">phis</span><span class="p">)),</span> <span class="n">denom</span><span class="p">)</span>

        <span class="c1"># To integrate, need to get the bounds. They&#39;re different depending on if h* &gt; 1</span>
        <span class="k">def</span> <span class="nf">lower_r_bound_pos</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">upper_r_bound_neg</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hstar</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">hstar</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">interp2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.line_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.line_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">line_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">phi_angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the average value of param across a diameter defined by φ = angle</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - phi_angle, angle to define diameter to integrate across</span>
<span class="sd">         - even_opt, see :any:area_avg</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Average value of param along φ = angle</span>
<span class="sd">        </span>
<span class="sd">        Uses scipy.integrate.simpsons</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">phi_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not area-average </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for condition </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Data for </span><span class="si">{</span><span class="n">phi_angle</span><span class="si">}</span><span class="s2"> not found after mirroring!&quot;</span><span class="p">)</span>
            <span class="k">return</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">r_for_int</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_for_int</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">phi_angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rstar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_for_int</span><span class="p">:</span>
                <span class="n">r_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">var_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">phi_angle</span> <span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span>
            <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span><span class="o">+</span><span class="mi">180</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span> <span class="o">-</span> <span class="mi">180</span>
        
        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rstar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_for_int</span><span class="p">:</span>
                <span class="n">r_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">var_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>

        <span class="n">var_for_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">r_for_int</span><span class="p">,</span> <span class="n">var_for_int</span><span class="p">))]</span>
        <span class="n">r_for_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r_for_int</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">var_for_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">r_for_int</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized length</span>

        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.line_avg_dev">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.line_avg_dev">[docs]</a>
    <span class="k">def</span> <span class="nf">line_avg_dev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">phi_angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the average value of param across a diameter defined by φ = angle</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to calculate line average deviation</span>
<span class="sd">         - phi_angle, angle to define diameter to integrate across</span>
<span class="sd">         - even_opt, see :any:area_avg</span>

<span class="sd">        Returns:</span>
<span class="sd">         - integrand result</span>
<span class="sd">        </span>
<span class="sd">        Taking param = :math:`\\psi`, mathematically, this function does</span>

<span class="sd">        .. math:: \\frac{\\langle \\psi - \\langle \\psi^2 \\rangle  \\rangle }{\\langle \\psi \\rangle^2}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">phi_angle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not area-average </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for condition </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Data for </span><span class="si">{</span><span class="n">phi_angle</span><span class="si">}</span><span class="s2"> not found after mirroring!&quot;</span><span class="p">)</span>
            <span class="k">return</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="n">r_for_int</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_for_int</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">phi_angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rstar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_for_int</span><span class="p">:</span>
                <span class="n">r_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">var_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">phi_angle</span> <span class="o">&lt;=</span><span class="mi">180</span><span class="p">:</span>
            <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span><span class="o">+</span><span class="mi">180</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comp_angle</span> <span class="o">=</span> <span class="n">phi_angle</span> <span class="o">-</span> <span class="mi">180</span>
        
        <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">comp_angle</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rstar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_for_int</span><span class="p">:</span>
                <span class="n">r_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">var_for_int</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">var_for_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">r_for_int</span><span class="p">,</span> <span class="n">var_for_int</span><span class="p">))]</span>
        <span class="n">r_for_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r_for_int</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">var_for_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">r_for_int</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized length</span>

        <span class="k">return</span> <span class="n">I</span></div>



<div class="viewcode-block" id="Condition.void_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.void_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">void_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the void-weighted area-average of a parameter, &quot;param&quot;</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - even_opt, passed to integration method</span>
<span class="sd">         - recalc, if area-average previously calculated, it was stored in a dictionary, and can just pull from there</span>

<span class="sd">        Returns:</span>
<span class="sd">         - void-weighted area-averaged parameter, or None if the method failed</span>
<span class="sd">        </span>
<span class="sd">        Uses Simpson&#39;s rule for integration, specifically scipy.integrate.simpsons</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid parameter </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> selected. Not present at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_loc</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;legacy&#39;</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Mirroring in area-avg&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>    <span class="c1"># We already have 0</span>
                    <span class="k">continue</span>

                <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                            <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with:&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                
                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

                <span class="nb">vars</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>      <span class="c1"># I noticed too late that the list goes from r/R = 0 to 1, not the other way around</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>        <span class="c1"># Already wrote the actual Simpson&#39;s rule part, easier to just do this</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
                    <span class="ne">ValueError</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;rs to integrate over </span><span class="si">{</span><span class="n">rs</span><span class="si">}</span><span class="s2"> must be the same length as params </span><span class="si">{</span><span class="nb">vars</span><span class="si">}</span><span class="s2">, occured at </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>

                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rs</span><span class="p">))</span>                <span class="c1"># r/R steps</span>

                <span class="n">la</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>      <span class="c1"># Simpson&#39;s Rule coefficient</span>
                    
                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                                <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">coeff</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">/</span> <span class="mi">2</span>
                                <span class="n">S</span> <span class="o">=</span> <span class="p">(</span><span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">S</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var</span>
                    
                    <span class="n">la</span> <span class="o">=</span> <span class="n">la</span> <span class="o">+</span> <span class="n">S</span>
                
                <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>

            <span class="n">I</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">param_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;legacy_old&#39;</span><span class="p">:</span>
            <span class="c1"># We have to integrate twice, once with resepect to r, again with respect to phi</span>
            <span class="c1"># Start with r</span>

            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirrored</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Mirroring in area-avg&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="mf">0.95</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="p">:</span>
                        <span class="n">S_1</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.95</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.95</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.90</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.90</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.90</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.85</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.85</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.80</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.80</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_2</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.8</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.80</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_3</span> <span class="o">=</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">S_1</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="n">S_2</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.90</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.9</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.9</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.80</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.8</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.8</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.70</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.7</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.60</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.6</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.5</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>
                        
                        <span class="n">S_3</span> <span class="o">=</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.4</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">4</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.2</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.00</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">r_dict</span><span class="p">[</span><span class="mf">0.0</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>               <span class="c1"># Might be doubling up</span>
                                <span class="p">))</span> <span class="o">/</span> <span class="mi">3</span>

                    <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">S_1</span><span class="p">,</span> <span class="n">S_2</span><span class="p">,</span> <span class="n">S_3</span><span class="p">)))</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    
            <span class="n">I</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">param_r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have to integrate twice, once with resepect to r, again with respect to phi</span>
            <span class="c1"># Start with r</span>

            <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>


            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># This should be unnecessary now with the new mirror, but it&#39;s not hurting anyone by being here</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                            <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with:&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                        <span class="c1">#if debug: print(angle, midas_dict, file=debugFID)</span>
                
                
                <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    
                <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                    <span class="c1">#I = 2 * np.pi</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>

        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="Condition.interp_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.interp_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">interp_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">interp_type</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">int_error</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the area-average of a parameter, &quot;param&quot;, based on an interpolation of the data</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - interp_type, option for what kind of interpolation to use</span>

<span class="sd">        Options for interp_type:</span>
<span class="sd">         - linear, see :any:`fit_linear_interp`</span>
<span class="sd">         - spline, see :any:`fit_spline`</span>

<span class="sd">        Returns:</span>
<span class="sd">         - area-averaged parameter</span>
<span class="sd">        </span>
<span class="sd">        Uses scipy.integrate.dblquad, may be computationally expensive</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span> <span class="c1"># phi will be in radians from dblquad</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="n">interp_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
        
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epsabs&#39;</span><span class="p">:</span> <span class="n">int_error</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())})[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="Condition.interp_void_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.interp_void_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">interp_void_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">interp_type</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">int_error</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating the void-weighted area-average of a parameter, &quot;param&quot;, based on an interpolation of the data</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - interp_type, option for what kind of interpolation to use</span>

<span class="sd">        Options for interp_type:</span>
<span class="sd">         - linear, see :any:`fit_linear_interp`</span>
<span class="sd">         - spline, see :any:`fit_spline`</span>

<span class="sd">        Returns:</span>
<span class="sd">         - void weighted area-averaged parameter</span>
<span class="sd">        </span>
<span class="sd">        Uses scipy.integrate.dblquad, may be computationally expensive</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span> <span class="c1"># phi will be in radians from dblquad</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="n">interp_type</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="n">interp_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
        
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epsabs&#39;</span><span class="p">:</span> <span class="n">int_error</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s1">&#39;points&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())}</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp_area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.spline_void_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.spline_void_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">spline_void_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">int_error</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to void-weighted area-average param based on a spline interpolation</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phi</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">](</span><span class="n">phi</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
        
        <span class="k">def</span> <span class="nf">integrand_denom</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">](</span><span class="n">phi</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>
        
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">epsabs</span> <span class="o">=</span> <span class="n">int_error</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand_denom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">epsabs</span> <span class="o">=</span> <span class="n">int_error</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="Condition.spline_circ_seg_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.spline_circ_seg_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">spline_circ_seg_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">hstar</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">int_err</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to area-average over a circular segment using the spline interpolation of param</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - param, string of local parameter to area-average</span>
<span class="sd">         - hstar, distance from the top of the pipe that defines circular segment</span>
<span class="sd">         - int_err, acceptable warning for integral error (passed to scipy.integrate.dblquad)</span>

<span class="sd">        Returns:</span>
<span class="sd">         - integrand result</span>

<span class="sd">        Uses scipy.integrate.dblquad. May be computationally expensive</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phi</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span>

        <span class="k">def</span> <span class="nf">integrand_denom</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">r</span>

        <span class="k">def</span> <span class="nf">lower_r_bound_pos</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">upper_r_bound_neg</span><span class="p">(</span><span class="n">phi</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">hstar</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">hstar</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hstar</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand_denom</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> <span class="n">lower_r_bound_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">hstar</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">integrate</span><span class="o">.</span><span class="n">dblquad</span><span class="p">(</span><span class="n">integrand_denom</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">upper_r_bound_neg</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">int_err</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.calc_void_cov">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_void_cov">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_void_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the void covariance</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;void_cov&quot; in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - void covariance</span>

<span class="sd">        Mathematically performing the operation</span>
<span class="sd">        </span>
<span class="sd">        .. math:: \\frac{\\langle \\alpha^2 \\rangle }{\\langle \\alpha \\rangle^2}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                    <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">param_r_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles_int</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">void_cov</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.calc_sigma_alpha">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_sigma_alpha">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_sigma_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the second moment of alpha</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;sigma_alpha&quot; in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - second moment of :math:`\\alpha`</span>

<span class="sd">        Mathematically performing the operation</span>

<span class="sd">        .. math:: \\frac{\\langle (\\alpha - \\langle \\alpha \\rangle)^2 \\rangle }{\\langle \\alpha \\rangle^2}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">alpha_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                    <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">param_r_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles_int</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha_avg</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated sigma_alpha: &#39;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_alpha</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="Condition.calc_sigma_alpha1">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_sigma_alpha1">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_sigma_alpha1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the second moment of alpha_G1</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;sigma_alpha1&quot; in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - second moment of :math:`\\alpha_{G1}`</span>

<span class="sd">        Mathematically performing the operation</span>

<span class="sd">        .. math:: \\frac{\\langle (\\alpha_{G1} - \\langle \\alpha_{G1} \\rangle)^2 \\rangle }{\\langle \\alpha_{G1} \\rangle^2}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">alpha_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_G1&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                    <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_G1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">param_r_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">param_r_int</span><span class="p">,</span> <span class="n">angles_int</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha_avg</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated sigma_alpha1: &#39;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_alpha1</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="Condition.calc_sigma_ug">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_sigma_ug">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_sigma_ug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the second moment of ug1</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;sigma_ug&quot; in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - sigma_ug</span>

<span class="sd">        Mathematically performing the operation</span>

<span class="sd">        .. math:: \\frac{\\langle (u_{g,1} - \\langle u_{g,1} \\rangle)^2 \\rangle }{\\langle u_{g,1} \\rangle^2}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">ug_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;ug1&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                    <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ug_avg</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">param_r_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles_int</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ug_avg</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated sigma_ug: &#39;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_ug</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">return</span> <span class="n">I</span></div>



<div class="viewcode-block" id="Condition.calc_mu3_alpha">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_mu3_alpha">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_mu3_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the third moment of alpha</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;mu3_alpha&quot; in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Third moment of :math:`\\alpha`</span>

<span class="sd">        Mathematically performing the operation</span>

<span class="sd">        .. math:: \\frac{\\langle (\\alpha - \\langle \\alpha \\rangle)^3 \\rangle }{\\langle \\alpha \\rangle^3}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="n">alpha_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                    <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
        <span class="n">param_r_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles_int</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r_int</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles_int</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha_avg</span><span class="o">**</span><span class="mi">3</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Calculated mu3_alpha: &#39;</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mu3_alpha</span> <span class="o">=</span> <span class="n">I</span>
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.top_bottom">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.top_bottom">[docs]</a>
    <span class="k">def</span> <span class="nf">top_bottom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Honestly, I forgot what this does</span>

<span class="sd">        I think it area-averages the way Bottin did, which is not</span>
<span class="sd">        a good way of doing so. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Check that the parameter that the user requested exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">90</span><span class="p">][</span><span class="mf">1.0</span><span class="p">][</span><span class="n">param</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KeyError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not area-average </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for condition </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># We have to integrate twice, once with resepect to r, again with respect to phi</span>
        <span class="c1"># Start with r</span>

        <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># array for parameter integrated wrt r</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="n">rs_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vars_temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="c1"># Convert degrees to radians</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># This should be unnecessary now with the new mirror, but it&#39;s not hurting anyone by being here</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rs_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rstar</span> <span class="p">)</span> <span class="c1"># This is proably equivalent to rs = list(r_dict.keys() ), but I&#39;m paranoid about ordering</span>
                        <span class="n">vars_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with:&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
                    <span class="c1">#if debug: print(angle, midas_dict, file=debugFID)</span>
            
            
            <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">,</span> <span class="n">vars_temp</span><span class="p">))]</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_temp</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arrays to integrate&quot;</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                
            <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># Integrate wrt r</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calculated integral:&quot;</span><span class="p">,</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">vars</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
                <span class="c1">#I = 2 * np.pi</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated wrt r&quot;</span><span class="p">,</span> <span class="n">param_r</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>

        <span class="n">param_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">param</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># Integrate wrt theta, divide by normalized area</span>
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="Condition.calc_dpdz">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_dpdz">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_dpdz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;LM&#39;</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.316</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">chisholm</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">k_m</span> <span class="o">=</span> <span class="mf">0.10</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">akapower</span> <span class="o">=</span> <span class="mf">0.875</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculates the frictional pressure gradient, dp/dz, according to various methods. Can access later with self.dpdz</span>
<span class="sd"> </span>
<span class="sd">        Options:</span>
<span class="sd">            - method    : Calculation method</span>
<span class="sd">              * &#39;LM&#39;    : Lockhart Martinelli</span>
<span class="sd">              * &#39;Kim&#39;   : Kim-modified Lockhart Martinelli</span>
<span class="sd">            - rho_f     : Liquid phase density</span>
<span class="sd">            - rho_g     : Gas phase density</span>
<span class="sd">            - mu_f      : Liquid phase dynamic viscosity</span>
<span class="sd">            - mu_g      : Gas phase dynamic viscosity</span>
<span class="sd">            - m         : Fed to calc_fric()</span>
<span class="sd">            - n         : Fed to calc_fric()</span>
<span class="sd">            - chisholm  : Chisholm parameter, the C in Lockhart-Martinelli</span>
<span class="sd">            - k_m       : Minor loss coefficient</span>
<span class="sd">            - L         : Length of restriction, only matters for &#39;Kim&#39; method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">chisholm</span> <span class="o">==</span> <span class="s1">&#39;Ryan&#39;</span><span class="p">:</span>
            <span class="n">chisholm</span> <span class="o">=</span> <span class="mi">26</span> <span class="o">-</span> <span class="mf">4.7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lm&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lockhart&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lockhart-martinelli&#39;</span><span class="p">:</span>
            <span class="n">f_f</span><span class="p">,</span> <span class="n">f_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">(</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>

            <span class="n">dpdz_f</span> <span class="o">=</span> <span class="n">f_f</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dpdz_g</span> <span class="o">=</span> <span class="n">f_g</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">chi2</span> <span class="o">=</span> <span class="n">dpdz_f</span> <span class="o">/</span> <span class="n">dpdz_g</span>

            <span class="n">phi_f2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">chisholm</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">chi2</span>
            <span class="n">dpdz</span> <span class="o">=</span> <span class="n">phi_f2</span> <span class="o">*</span> <span class="n">dpdz_f</span>

        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;kim&#39;</span><span class="p">:</span>
            <span class="n">f_f</span><span class="p">,</span> <span class="n">f_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">(</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>

            <span class="n">dpdz_f</span> <span class="o">=</span> <span class="n">f_f</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dpdz_g</span> <span class="o">=</span> <span class="n">f_g</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">dpdz_m</span> <span class="o">=</span> <span class="n">k_m</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">L</span>

            <span class="n">chi2</span> <span class="o">=</span> <span class="n">dpdz_f</span> <span class="o">/</span> <span class="n">dpdz_g</span>
            <span class="n">chiM2</span> <span class="o">=</span> <span class="n">dpdz_f</span> <span class="o">/</span> <span class="n">dpdz_m</span>

            <span class="n">phi_f2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">chiM2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">chiM2</span><span class="p">)</span> <span class="o">*</span> <span class="n">chisholm</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chi2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">chi2</span>
            <span class="n">dpdz</span> <span class="o">=</span> <span class="n">phi_f2</span> <span class="o">*</span> <span class="n">dpdz_f</span>

        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;akagawa&#39;</span><span class="p">:</span>
            <span class="n">f_f</span><span class="p">,</span> <span class="n">f_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">(</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">)</span>

            <span class="n">dpdz_f</span> <span class="o">=</span> <span class="n">f_f</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">phi_f2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">akapower</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

            <span class="n">dpdz</span> <span class="o">=</span> <span class="n">phi_f2</span> <span class="o">*</span> <span class="n">dpdz_f</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1"> is not a valid option for calc_dpdz. Try &quot;LM&quot; &#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dpdz</span> <span class="o">=</span> <span class="n">dpdz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_w</span> <span class="o">=</span> <span class="n">dpdz</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">/</span> <span class="mi">4</span>

        <span class="k">return</span> <span class="n">dpdz</span></div>


<div class="viewcode-block" id="Condition.calc_vwvg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vwvg">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vwvg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates void weighted Vgj</span>

<span class="sd">        uses self.jgloc / self.area_avg(&#39;alpha&#39;), which is not a great method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This guy needs work, probably don&#39;t want to use it&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vwvg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_W">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_W">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_W</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the third moment of alpha</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;W&quot; in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average W</span>

<span class="sd">        Mathematically performing the operation</span>

<span class="sd">        .. math:: W = \\frac{v_r}{v_f}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">vfp</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calc_vr</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">vfp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning, vf = 0 but vr != 0. Defaulting to W = 0&quot;</span><span class="p">)</span>
                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                            <span class="s1">&#39;W&#39;</span> <span class="p">:</span> <span class="mi">0</span>
                        <span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                        <span class="s1">&#39;W&#39;</span> <span class="p">:</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">vfp</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_fric">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_fric">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_fric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;Blasius&#39;</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mf">0.316</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.25</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculates friction factor for each phase based on bulk Re</span>

<span class="sd">        .. math:: Re_k = \\frac{\\rho_k j_k D}{\\mu_k}</span>

<span class="sd">        Method Options:</span>
<span class="sd">         - Blasius</span>

<span class="sd">         .. math:: f_k = \\frac{C}{Re_k^n}</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Tuple of f_f, f_g</span>
<span class="sd">        </span>
<span class="sd">        Stores</span>
<span class="sd">         - self.ff</span>
<span class="sd">         - self.fg</span>
<span class="sd">         - self.tau_fw</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">Re_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span>
        <span class="n">Re_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span>

        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;blasius&#39;</span><span class="p">:</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="n">Re_f</span><span class="o">**</span><span class="n">n</span>
            <span class="n">fg</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="n">Re_g</span><span class="o">**</span><span class="n">n</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Invalid method, try Blasius&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ff</span> <span class="o">=</span> <span class="n">ff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fg</span> <span class="o">=</span> <span class="n">fg</span>
        <span class="n">tau_fw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ff</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span> <span class="o">=</span> <span class="n">tau_fw</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">fg</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="Condition.calc_mu_eff">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_mu_eff">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_mu_eff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Ishii&#39;</span><span class="p">,</span> <span class="n">alpha_peak</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for effective/mixture viscosity</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - method, what method to use for modeling :math:`\\mu_{eff}`</span>
<span class="sd">         - alpha_peak, parameter for some models</span>
<span class="sd">        </span>
<span class="sd">        Stores:</span>
<span class="sd">         - &quot;mu_eff&quot; in midas_dict </span>
<span class="sd">         - &quot;mu_m&quot; in midas_dict</span>

<span class="sd">        Options for method:</span>
<span class="sd">         - Ishii, :math:`\\mu_{eff} = \\mu_{m} = \\mu_{f} (1 - \\frac{\\alpha}{ \\alpha_{max} })^{-2.5 \\alpha_{max} \\frac{\\mu_g + 0.4 \\mu_g}{\\mu_g + \\mu_g} }`</span>
<span class="sd">         - Ishii_AA, :math:`\\mu_{eff} = \\mu_{m} = \\mu_{f} (1 - \\frac{\\langle \\alpha \\rangle}{ \\alpha_{max} })^{-2.5 \\alpha_{max} \\frac{\\mu_g + 0.4 \\mu_g}{\\mu_g + \\mu_g} }`</span>

<span class="sd">        Returns:</span>
<span class="sd">         - area average effective viscosity</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>
        <span class="n">alpha_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
                
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii&#39;</span><span class="p">:</span>
                    <span class="n">mu_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">alpha_peak</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">alpha_peak</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span> <span class="o">+</span> <span class="mf">0.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span><span class="p">)</span>  <span class="p">)</span>

                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii_aa&#39;</span><span class="p">:</span>
                    <span class="n">mu_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">alpha_peak</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">alpha_peak</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span> <span class="o">+</span> <span class="mf">0.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu_g</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span><span class="p">)</span>  <span class="p">)</span>
                    
                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;avg_void&#39;</span><span class="p">:</span>
                    <span class="n">mu_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown option for calc_mu_eff&quot;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">mu_m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">mu_m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Non-zero or imaginary mu_eff: </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">mu_m</span><span class="si">}</span><span class="s2">. Setting to mu_f&quot;</span><span class="p">)</span>
                    <span class="n">mu_eff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span>

                <span class="n">mu_eff</span> <span class="o">=</span> <span class="n">mu_m</span>
                <span class="n">mu_m</span> <span class="o">=</span> <span class="n">mu_eff</span>

                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;mu_eff&#39;</span><span class="p">:</span> <span class="n">mu_eff</span><span class="p">})</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;mu_m&#39;</span><span class="p">:</span> <span class="n">mu_m</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;mu_eff&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Condition.calc_cd">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_cd">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_cd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Ishii-Zuber&#39;</span><span class="p">,</span> <span class="n">vr_cheat</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">,</span> <span class="n">const_CD</span> <span class="o">=</span> <span class="mf">0.44</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating drag coefficient</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">         - method, what method to use for modeling :math:`C_{D}`</span>
<span class="sd">         - vr_cheat, flag to use &quot;vr&quot; from midas_dict or &quot;vr_model&quot; when calculating :math:`Re_{b}`</span>
<span class="sd">         - limit, if supplied, will limit the drag coefficient to the given maximum value. For instance, 0.44 like in CFX</span>
<span class="sd">        </span>
<span class="sd">        Stores:</span>
<span class="sd">         - &quot;cd&quot; in midas_dict </span>
<span class="sd">         - &quot;Reb&quot; in midas_dict. Calculated by :math:`Re_{b} = \\frac{(1 - \\alpha) \\rho_{f} v_{r} D_{sm,1} }{\\mu_{m}}`.</span>
<span class="sd">         </span>
<span class="sd">         :math:`\\mu_{m}` comes from :any:`calc_mu_eff`</span>

<span class="sd">         - &quot;eo&quot;, if using &quot;tomiyama&quot; or &quot;ishii&quot; limits</span>

<span class="sd">        Options for method:</span>
<span class="sd">         - Ishii-Zuber, :math:`C_{D} = \\frac{24}{Re_{b}} (1 + 0.1 Re_{b}^{0.75})`</span>
<span class="sd">         - Schiller-Naumann, :math:`C_{D} = \\frac{24}{Re_{b}} (1 + 0.15 Re_{b}^{0.687})`. Here, :math:`Re_{b}` uses :math:`\\mu_{f}`</span>
<span class="sd">         - const</span>

<span class="sd">        Returns:</span>
<span class="sd">         - area average drag coefficient</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">calc_mu_eff</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="n">vr_cheat</span><span class="p">:</span>
                    <span class="n">Reb</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;mu_m&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="s1">&#39;vr_model&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c1"># Initialize for iteration</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vr_model&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>

                    <span class="n">Reb</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;mu_m&#39;</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Reb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;RuntimeWarning: Reb negative!&quot;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Reb</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">]),</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;mu_m&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;RuntimeWarning: Reb imaginary!&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Reb</span><span class="p">,</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">],</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">]),</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;mu_m&#39;</span><span class="p">])</span>
                
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;Reb&#39;</span><span class="p">:</span> <span class="n">Reb</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Ishii-Zuber&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;IZ&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Ishii&#39;</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">Reb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cd</span> <span class="o">=</span> <span class="mi">24</span><span class="o">/</span><span class="n">Reb</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Reb</span><span class="o">**</span><span class="mf">0.75</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cd</span> <span class="o">=</span> <span class="n">limit</span>

                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;schiller-naumann&#39;</span><span class="p">:</span>
                    <span class="n">Reb</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_f</span>

                    <span class="n">cd</span> <span class="o">=</span> <span class="mi">24</span><span class="o">/</span><span class="n">Reb</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.15</span><span class="o">*</span><span class="n">Reb</span><span class="o">**</span><span class="mf">0.687</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;const&#39;</span><span class="p">:</span>
                    <span class="n">cd</span> <span class="o">=</span> <span class="n">const_CD</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">limit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;tomiyama&quot;</span><span class="p">:</span>
                        <span class="n">eo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm2&#39;</span><span class="p">]</span>
                        <span class="n">limit</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">eo</span> <span class="o">/</span> <span class="p">(</span><span class="n">eo</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;eo&#39;</span><span class="p">:</span> <span class="n">eo</span><span class="p">})</span>
                        
                    <span class="k">elif</span> <span class="n">limit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii-chawla&#39;</span><span class="p">:</span>
                        <span class="n">eo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm2&#39;</span><span class="p">]</span>
                        <span class="n">limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eo</span><span class="p">),</span> <span class="mi">8</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;eo&#39;</span><span class="p">:</span> <span class="n">eo</span><span class="p">})</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2"> not a valid type for limiting behavior. Please enter tomiyama, Ishii-Chawla, or set a constant limit (e.g. limit = 0.44)&quot;</span><span class="p">)</span>
                
                <span class="n">cd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span> <span class="c1"># Either 0, set by user, or set by above string</span>

                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cd&#39;</span><span class="p">:</span> <span class="n">cd</span><span class="p">})</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_Reb">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_Reb">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_Reb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO, function to calculate bubble Reynolds number</span>

<span class="sd">        Options:</span>
<span class="sd">         - ???</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">Reb</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;Reb&#39;</span><span class="p">:</span> <span class="n">Reb</span><span class="p">})</span></div>


<div class="viewcode-block" id="Condition.calc_cl">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_cl">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_cl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;tomiyama&#39;</span><span class="p">,</span> <span class="n">sharma_factor</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO, function to calculate lift coefficient</span>

<span class="sd">        :param method: method to use to calculate lift coefficient, defaults to &#39;tomiyama&#39;</span>
<span class="sd">        :type method: str, optional</span>
<span class="sd">        :param sharma_factor: Option to use Sharma&#39;s exponential Ref, defaults to False</span>
<span class="sd">        :type sharma_factor: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;tomiyama&#39;</span><span class="p">:</span>
                    <span class="n">CL</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hibiki-ishii&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;hi&#39;</span><span class="p">:</span>
                    <span class="n">CL</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;CL&#39;</span><span class="p">:</span> <span class="n">CL</span><span class="p">})</span></div>


<div class="viewcode-block" id="Condition.calc_vr_model">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vr_model">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vr_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;km1_simp&#39;</span><span class="p">,</span> <span class="n">kw</span> <span class="o">=</span> <span class="mf">0.654</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Lw</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kf</span> <span class="o">=</span> <span class="mf">0.113</span><span class="p">,</span> 
                      <span class="n">iterate_cd</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">initial_vr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                      <span class="n">quiet</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">recalc_cd</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">iter_tol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">custom_f</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">CC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<span class="sd">        </span>
<span class="sd">        **Args**:</span>
<span class="sd">        </span>
<span class="sd">         - ``method``: what method to use for modeling :math:`v_{r}`. Defaults to &#39;km1_simp&#39;. Options include:</span>

<span class="sd">             - ``&#39;wake_1&#39;``, depracated, earliest attempt, don&#39;t use</span>

<span class="sd">             .. math:: v_{r} = K_{w} v_{f} C_{D}^{1/3}</span>

<span class="sd">             - ``&#39;wake_alpha&#39;``, depracated, don&#39;t use</span>

<span class="sd">             .. math:: v_{r} = K_{w} (1-\\alpha)^{n} v_{f} C_{D}^{1/3}</span>

<span class="sd">             - ``&#39;wake_alpha2&#39;``, depracated, don&#39;t use</span>

<span class="sd">             .. math:: v_{r} = K_{w} \\alpha (1-\\alpha)^{n} v_{f} C_{D}^{1/3}</span>

<span class="sd">             - ``&#39;wake_lambda&#39;``, depracated, don&#39;t use</span>
<span class="sd">             - ``&#39;wake_vg_lambda&#39;``, depracated, don&#39;t use</span>
<span class="sd">             - ``&#39;hubris&#39;``, depracated, don&#39;t use</span>
<span class="sd">             - ``&#39;km1&#39;``, depracated, don&#39;t use</span>
<span class="sd">             - ``&#39;km1&#39;``, depracated, don&#39;t use</span>
<span class="sd">         - ``kw``: _description_. Defaults to 0.654.</span>
<span class="sd">         - ``n``: _description_. Defaults to 1.</span>
<span class="sd">         - ``Lw``: _description_. Defaults to 5.</span>
<span class="sd">         - ``kf``: _description_. Defaults to 0.113.</span>
<span class="sd">         - ``iterate_cd``: _description_. Defaults to True.</span>
<span class="sd">         - ``initial_vr``: _description_. Defaults to None.</span>
<span class="sd">         - ``quiet``: _description_. Defaults to True.</span>
<span class="sd">         - ``recalc_cd``: _description_. Defaults to True.</span>
<span class="sd">         - ``iter_tol``: _description_. Defaults to 1e-4.</span>
<span class="sd">         - ``custom_f``: _description_. Defaults to None.</span>
<span class="sd">         - ``CC``: _description_. Defaults to 1.</span>
<span class="sd">        </span>
<span class="sd">        **Raises**:</span>
<span class="sd">        </span>
<span class="sd">         - ``ValueError``: _description_</span>
<span class="sd">        </span>
<span class="sd">        **Returns**:</span>
<span class="sd">        </span>
<span class="sd">         - area average relative velocity calculated by the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#         Method for calculating relative velocity based on models</span>
        
<span class="c1">#         Inputs:</span>
<span class="c1">#          - method, </span>
<span class="c1">#          - kw, wake coeffieient for some models</span>
<span class="c1">#          - n, exponent for some models</span>
<span class="c1">#          - Lw, really :math:`L_{w}^{*}`, effective wake length divided by the bubble diameter</span>
<span class="c1">#          - kf, fluid coefficient for some models</span>
<span class="c1">#          - iterate_cd, flag to pass to :any:`calc_cd`. Basically whether to iterate to calculate :math:`C_{D}` based on \</span>
<span class="c1"># the newly calculated :math:`v_{r}` or not</span>
<span class="c1">#          - quiet, flag for extra debugging messages</span>
        
<span class="c1">#         Stores:</span>
<span class="c1">#          - &quot;vr\_&#39;method_name&#39;&quot; in midas_dict </span>
<span class="c1">#          - &quot;vr_model&quot; in midas_dict </span>

<span class="c1">#         Options for method:</span>
<span class="c1">#          - &quot;km1_simp&quot;, most up to date :math:`v_{r} = K_{f} - K_{w}  \\alpha  v_{f}  C_{d}^{1/3}`</span>
<span class="c1">#          - &quot;Ishii-Chawla&quot;, :math:`v_{r} = \\sqrt{2} (\\frac{\\sigma g \\Delta \\rho}{\\rho_{f}^{2}})^{1/4}`</span>
<span class="c1">#          - A bunch of obsolete ones that I haven&#39;t deleted but probably should</span>

<span class="c1">#         Returns:</span>
<span class="c1">#          - </span>
        

        <span class="n">MAX_ITERATIONS</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">initialize_vr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">initial_vr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">initial_vr</span> <span class="o">=</span> <span class="mf">0.5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_vr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recalc_cd</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iterate_cd</span><span class="p">:</span>
                    
                    <span class="k">if</span> <span class="n">initialize_vr</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                                    <span class="p">{</span><span class="s1">&#39;vr_model&#39;</span><span class="p">:</span> <span class="n">initial_vr</span><span class="p">}</span>
                                <span class="p">)</span>
                        <span class="n">initialize_vr</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">(</span><span class="n">vr_cheat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">(</span><span class="n">vr_cheat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">old_vr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">old_vr</span> <span class="o">=</span> <span class="n">initial_vr</span> <span class="c1"># Initialize?</span>

            <span class="n">vr_name</span> <span class="o">=</span> <span class="s2">&quot;vr_&quot;</span> <span class="o">+</span> <span class="n">method</span>

            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_1&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span>  <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_alpha&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span>  <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                    
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_alpha2&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span>  <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]))</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_lambda&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_avg_lat_sep</span><span class="p">()</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span>  <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_vg_lambda&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_avg_lat_sep</span><span class="p">()</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;hubris&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;wake_vr&#39;</span><span class="p">:</span>
                        <span class="n">cd</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span>
                        <span class="n">c2</span> <span class="o">=</span> <span class="n">kw</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span><span class="n">kw</span><span class="o">*</span> <span class="n">cd</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span> <span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span> <span class="n">Lw</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span> <span class="n">c2</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cd</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cd</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">)))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="o">*</span> <span class="n">cd</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))))</span>
                    
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;km1&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span>  <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">Lw</span><span class="p">)</span> <span class="o">+</span> <span class="n">kf</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>
                    
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;km1_simp&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;prelim&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;final_horizontal&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">kf</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;prelim_plus&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">custom_f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">ff</span><span class="p">,</span> <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ff</span> <span class="o">=</span> <span class="n">custom_f</span>

                        <span class="c1"># if midas_dict[&#39;Dsm1&#39;] == 0 and rstar != 1.0:</span>
                        <span class="c1">#     print(self, angle, rstar)</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="o">+</span><span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">kf</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> 
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">4.</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">ff</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> 
                                                                                 <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gz</span> <span class="p">)</span> <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="k">if</span> <span class="n">vr</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="ow">and</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vr nan for </span><span class="si">{</span><span class="n">angle</span><span class="p">,</span><span class="w"> </span><span class="n">rstar</span><span class="si">}</span><span class="s2">, setting to 0&quot;</span><span class="p">)</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span>
                        
                        <span class="k">if</span> <span class="n">vr</span> <span class="o">!=</span> <span class="n">vr</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vr nan for </span><span class="si">{</span><span class="n">angle</span><span class="p">,</span><span class="w"> </span><span class="n">rstar</span><span class="si">}</span><span class="s2">, setting to 0&quot;</span><span class="p">)</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">old_vr</span><span class="p">)</span> <span class="o">*</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">kf</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vf&#39;</span><span class="p">]</span> 
                            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">4.</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">)</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gz</span> <span class="p">)</span> <span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                            <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span>
                        

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;proper_integral&#39;</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This method is probably no good, messed up the math&quot;</span><span class="p">)</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">Lw</span><span class="p">)</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;proper_integral_alpha&#39;</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This method is probably no good, messed up the math&quot;</span><span class="p">)</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">Lw</span><span class="p">)</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>

                    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii-chawla&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ishii chawla&#39;</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mf">0.25</span>
                    
                    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;chahed&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_dpdz</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;vf&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                            <span class="n">discrim</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># print(self.Dh, self.rho_f, midas_dict[&#39;cd&#39;], midas_dict[&#39;alpha&#39;])</span>
                            <span class="n">discrim</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">4</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_w</span>  <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gz</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">CC</span><span class="o">/</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_alpha_r&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_vf_r&#39;</span><span class="p">])</span>

                        <span class="n">vr</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">discrim</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">discrim</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

                    <span class="k">if</span> <span class="n">rstar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">if</span> <span class="n">vr</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span>
                    <span class="k">elif</span> <span class="n">vr</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="p">:</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span>
            
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">vr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">vr</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vr</span>


            <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating vr&quot;</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">old_vr</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="ow">or</span> <span class="n">old_vr</span> <span class="o">!=</span> <span class="n">old_vr</span> <span class="ow">or</span> <span class="n">vr</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating vr: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">old_vr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vr_model calculated as 0 after </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">old_vr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">old_vr</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">old_vr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">iter_tol</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vr_model converged in </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">old_vr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span> <span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s2">&quot;vr_model&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">iterations</span> <span class="o">&gt;</span> <span class="n">MAX_ITERATIONS</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning, max iterations exceeded in calculating vr_model&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">old_vr</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="p">(</span><span class="n">old_vr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;vr_model&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recalc</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">/</span><span class="n">old_vr</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s2">&quot;vr_model&quot;</span><span class="p">)</span></div>


            
<div class="viewcode-block" id="Condition.calc_vgj_model">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vgj_model">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vgj_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for calculating local Vgj based on models</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``midas_dict[&#39;vgj_model&#39;] = (1 - midas_dict[&#39;alpha&#39;]) * midas_dict[&#39;vr_model&#39;]``</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                <span class="k">if</span> <span class="s1">&#39;vr_model&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">midas_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: vr_model not found for </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">, calling calc_vr_model with default inputs&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calc_vr_model</span><span class="p">()</span>

                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vgj_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;vr_model&#39;</span><span class="p">]</span>

        <span class="k">return</span></div>

    
<div class="viewcode-block" id="Condition.calc_IS_term">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_IS_term">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_IS_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the interfacial shear term, for the 1-D averaged TFM, :math:`\\nabla \\alpha \\bullet \\tau_{i}`</span>
<span class="sd">        </span>
<span class="sd">        **Args**:</span>

<span class="sd">         - ``method``: method used to calculate term. Defaults to &#39;power&#39;. Options:</span>

<span class="sd">             - ``power``</span>

<span class="sd">             .. math:: \\tau_{i} = \\tau_{fw} (r^{*})^{n}</span>

<span class="sd">             - ``power_total``</span>
<span class="sd">             - ``lognorm``</span>
<span class="sd">             - ``alpha``</span>
<span class="sd">         - ``n``: _description_. Defaults to 2.</span>
<span class="sd">         - ``mu``: _description_. Defaults to 1.5.</span>
<span class="sd">        </span>
<span class="sd">        **Returns**:</span>

<span class="sd">         - ``self.area_avg(&#39;ISxgrad&#39;)``. ``&#39;ISxgrad`` and ``&#39;IS&#39;`` stored in ``midas_dict``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_grad</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r_star</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="k">if</span> <span class="n">r_star</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;IS&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">,</span> <span class="s1">&#39;ISxgrad&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                         <span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
                        <span class="n">taui</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span> <span class="o">*</span> <span class="n">r_star</span><span class="o">**</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;ISxgrad&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span> <span class="o">*</span> <span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_alpha_r&#39;</span><span class="p">]</span> <span class="p">))</span> <span class="p">,</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span> <span class="n">taui</span><span class="p">}</span>
                         <span class="p">)</span>
        
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;power_total&#39;</span><span class="p">:</span>
                        <span class="n">taui</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span> <span class="o">*</span> <span class="n">r_star</span><span class="o">**</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;ISxgrad&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_alpha_total&#39;</span><span class="p">]</span> <span class="p">))</span> <span class="p">,</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span> <span class="n">taui</span><span class="p">}</span>
                        <span class="p">)</span>
                        
                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;lognorm&#39;</span><span class="p">:</span>
                        <span class="n">taui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r_star</span><span class="p">)</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;ISxgrad&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_alpha_r&#39;</span><span class="p">]</span> <span class="p">))</span> <span class="p">,</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span><span class="p">)}</span>
                        <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                        <span class="n">taui</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
                        <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;ISxgrad&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span> <span class="o">*</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;grad_alpha_r&#39;</span><span class="p">]</span> <span class="p">))</span> <span class="p">,</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">taui</span><span class="p">)}</span>
                        <span class="p">)</span>


        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;ISxgrad&#39;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_aa_vr_model">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_aa_vr_model">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_aa_vr_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;km1_naive&#39;</span><span class="p">,</span> <span class="n">IS_method</span> <span class="o">=</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="mf">0.654</span><span class="p">,</span> <span class="n">kf</span><span class="o">=</span><span class="mf">0.113</span><span class="p">,</span> <span class="n">Lw</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Ctau</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">IS_mu</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">Cvfacd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;to calculate estimate the area-averaged relative velocity</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``method``: _description_. Defaults to &#39;km1_naive&#39;.</span>

<span class="sd">             - ``km1_naive``, depracated, similar to ``prelim`` but with an older form and different coefficients</span>

<span class="sd">             .. math:: \\langle v_{r} \\rangle = K_{f} \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle} + K_{w} \\frac{\\pi}{4} \\frac{2^{-1/3}-L_{w}^{1/3}}{0.5-L_{w}} \\langle C_{D} \\rangle^{1/3} \\langle \\alpha \\rangle \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle}</span>

<span class="sd">             - ``km1_naive2``, depracated, same as ``prelim``, but signs of :math:`K_{w}` and :math:`K_{f}` flipped.</span>
<span class="sd">             - ``prelim``, Same as final, but no covariance. For backwards compatability </span>

<span class="sd">             .. math:: \\langle v_{r} \\rangle = - K_{f} \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle} - K_{w} \\langle C_{D} \\rangle^{1/3} \\langle \\alpha \\rangle \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle}</span>

<span class="sd">             - ``final``, recommended method, Eq. (4.37) of Dix (2025)</span>

<span class="sd">             .. math:: \\langle v_{r} \\rangle = - K_{f} \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle} - K_{w} C_{\\alpha, v_{f}} \\langle C_{D} \\rangle^{1/3} \\langle \\alpha \\rangle \\frac{\\langle j_{f} \\rangle}{1 - \\langle \\alpha \\rangle}</span>

<span class="sd">             - ``IS_Ctau``, uses a 1-D interfacial shear model with :math:`C_{\\tau}` to calculate :math:`v_{r}`. Not recommended</span>

<span class="sd">             .. math:: \\langle v_{r} \\rangle | \\langle v_{r} \\rangle| = \\frac{8 r_{b}}{3} \\frac{1}{C_{D} \\rho_{f}} ((1-C_{\\tau})\\frac{4 \\tau_{fw}}{D_{h}} + (1-\\langle \\alpha \\rangle)g_{z}(\\rho_{f} - \\rho_{g}) )</span>
<span class="sd">             </span>
<span class="sd">             - ``IS``, using 1-D interfacial shear model. Uses :meth:`~MARIGOLD.Condition.Condition.calc_IS_term` for :math:`\\tau_{i}`. Not recommended</span>

<span class="sd">             .. math:: \\langle v_{r} \\rangle | \\langle v_{r} \\rangle| = \\frac{8 r_{b}}{3} \\frac{1}{C_{D} \\rho_{f}} (\\frac{4 \\tau_{fw}}{D_{h}} + (1-\\langle \\alpha \\rangle)g_{z}(\\rho_{f} - \\rho_{g}) - \\frac{1}{\\langle \\alpha \\rangle} \\tau_{i})</span>
<span class="sd">         </span>
<span class="sd">         - ``IS_method``: When ``method=&#39;IS&#39;``, what method to pass to use for interfacial shear calculation. See :meth:`~MARIGOLD.Condition.Condition.calc_IS_term` for options. Defaults to ``&#39;power&#39;``. </span>
<span class="sd">         - ``kw``: Wake coefficient. Defaults to 0.654.</span>
<span class="sd">         - ``kf``: Liquid coefficient. Defaults to 0.113.</span>
<span class="sd">         - ``Lw``: Effective wake length. Defaults to 5.</span>
<span class="sd">         - ``Ctau``: Interfacial shear constant. Defaults to 1.</span>
<span class="sd">         - ``n``: Power constant. Defaults to 2.</span>
<span class="sd">         - ``IS_mu``: Interfacial shear viscosity. Defaults to 1.5.</span>
<span class="sd">         - ``Cvfacd``: Covariance. Defaults to 1.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - ``self.aa_vr``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;km1_naive&#39;</span><span class="p">:</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span>  <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lw</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">Lw</span><span class="p">)</span> <span class="o">+</span> <span class="n">kf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;km1_naive2&#39;</span> <span class="p">:</span><span class="c1">#or method == &#39;prelim&#39;:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">()</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>  <span class="o">+</span> <span class="n">kf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;km1_simp&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;prelim&#39;</span><span class="p">:</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="o">-</span><span class="n">kw</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">kf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">()</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">Cvfacd</span> <span class="o">*</span> <span class="o">-</span><span class="n">kw</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">kf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span>
        
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;IS_Ctau&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_cd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_fric</span><span class="p">()</span>
            <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span><span class="mi">1000</span> <span class="c1"># Convert to m</span>
            <span class="n">CD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>

            <span class="n">discrim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gz</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Ctau</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">discrim</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">rb</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">CD</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">discrim</span> <span class="p">))</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;IS&#39;</span><span class="p">:</span>
            <span class="n">IS_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_IS_term</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">IS_method</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">IS_mu</span><span class="p">)</span>

            <span class="n">rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span><span class="mi">1000</span> <span class="c1"># Convert to m</span>
            <span class="n">CD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;cd&#39;</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>

            <span class="n">discrim</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_fw</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Dh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gz</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">IS_term</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">discrim</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">rb</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">CD</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">discrim</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid calc_aa_vr_model method&quot;</span><span class="p">))</span>
            

        <span class="bp">self</span><span class="o">.</span><span class="n">vwvgj</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">vr</span> <span class="c1"># Legacy, do not use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aa_vr</span> <span class="o">=</span> <span class="n">vr</span>
        <span class="k">return</span> <span class="n">vr</span></div>

    
<div class="viewcode-block" id="Condition.calc_vw_aa_Vgj_model">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vw_aa_Vgj_model">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vw_aa_Vgj_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Kw</span><span class="o">=</span><span class="mf">0.654</span><span class="p">,</span> <span class="n">Kf</span><span class="o">=</span><span class="mf">0.113</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Calculate drift velocity, :math:`\\langle \\langle V_{gj} \\rangle \\rangle`, based on Dix (2025) model. See Eq. (4.47) of his thesis</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``Kw``: Wake coefficient. Defaults to 0.654.</span>
<span class="sd">         - ``Kf``: Liquid coefficient. Defaults to 0.113.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - ``self.vw_aa_Vgj_model``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cajf</span> <span class="o">=</span> <span class="mf">0.12</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">+</span> <span class="mf">0.43</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="o">**-</span><span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cajc</span> <span class="o">=</span> <span class="mf">61.4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="o">**-</span><span class="mf">2.25</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">rdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">rdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">midas_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cd13&#39;</span><span class="p">:</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;cd&#39;</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vw_aa_Vgj_model</span> <span class="o">=</span> <span class="o">-</span><span class="n">Kf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cajf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">-</span> <span class="n">Kw</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cajc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cajf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">void_area_avg</span><span class="p">(</span><span class="s1">&#39;cd13&#39;</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw_aa_Vgj_model</span></div>

    
<div class="viewcode-block" id="Condition.calc_errors">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_errors">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the errors, ε, between two parameters (param1 - param2) in midas_dict</span>

<span class="sd">        Usually want to do param1=predicted, param2=experimental</span>

<span class="sd">        If param2 = 0, relative errors are considered 0</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param1``: parameter to calculate error between (predicted)</span>
<span class="sd">         - ``param2``: parameter to calculate error between (experimental)</span>

<span class="sd">        Stores:</span>
<span class="sd">         - error, ``&#39;eps_param1_param2&#39;``, param1 - param2</span>
<span class="sd">         - relative, ``&#39;eps_rel_param1_param2&#39;``, (param1 - param2) / param2</span>
<span class="sd">         - absolute relative, ``&#39;eps_abs_rel_param1_param2&#39;``, | param1 - param2 | / param2</span>
<span class="sd">         - square, ``&#39;eps_sq_param1_param2&#39;``, (param1 - param2)**2</span>
<span class="sd">         - relative square, ``&#39;eps_rel_sq_param1_param2&#39;``, ((param1 - param2)/param2)**2</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - Area-averaged error</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">param_error_name</span> <span class="o">=</span> <span class="s2">&quot;eps_&quot;</span> <span class="o">+</span> <span class="n">param1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param2</span>
        <span class="n">param_rel_error_name</span> <span class="o">=</span> <span class="s2">&quot;eps_rel_&quot;</span> <span class="o">+</span> <span class="n">param1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param2</span>
        <span class="n">param_abs_rel_error_name</span> <span class="o">=</span> <span class="s2">&quot;eps_abs_rel_&quot;</span> <span class="o">+</span> <span class="n">param1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param2</span>
        <span class="n">param_sq_error_name</span> <span class="o">=</span> <span class="s2">&quot;eps_sq_&quot;</span> <span class="o">+</span> <span class="n">param1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param2</span>
        <span class="n">param_rel_sq_error_name</span> <span class="o">=</span> <span class="s2">&quot;eps_rel_sq_&quot;</span> <span class="o">+</span> <span class="n">param1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">param2</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param1</span><span class="p">]</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">]</span>
                <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_sq_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param1</span><span class="p">]</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

                <span class="k">if</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_rel_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param1</span><span class="p">]</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">]</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_rel_sq_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param1</span><span class="p">]</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_abs_rel_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param1</span><span class="p">]</span> <span class="o">-</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="n">param2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_rel_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_rel_sq_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="n">param_abs_rel_error_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param_error_name</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.calc_AA_error">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_AA_error">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_AA_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param1</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">param2</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the error, ε, between the area-average of two parameters (⟨param1⟩ - ⟨param2⟩) in ``midas_dict``</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param1``: parameter to calculate error between (predicted)</span>
<span class="sd">         - ``param2``: parameter to calculate error between (experimental)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - relative error (⟨param1⟩ - ⟨param2⟩) / ⟨param1⟩</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param2</span><span class="p">)</span>
        <span class="n">rel_error</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rel_error</span></div>


<div class="viewcode-block" id="Condition.calc_symmetry">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_symmetry">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">sym_type</span> <span class="o">=</span> <span class="s1">&#39;sym90&#39;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="n">rel_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function for checking the symmetry of a condition</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``sym_type``: type of symmetry to compare. Defaults to &#39;sym90&#39;. Currently the only option.</span>
<span class="sd">         - ``method``: error options. Defaults to &#39;rmse&#39;. Options:</span>
<span class="sd">             - ``&#39;rmse&#39;``, :math:`\\epsilon_{sym} = \\sqrt{\\bar{\\epsilon(r)^{2}}}`</span>
<span class="sd">             - ``&#39;mean&#39;``, :math:`\\epsilon_{sym} = \\bar{\\epsilon(r)}`</span>
<span class="sd">         - ``rel_error``: will divide by param. Defaults to False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - :math:`\\epsilon_{sym}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">errs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">sym_type</span> <span class="o">==</span> <span class="s1">&#39;sym90&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="n">r_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">180</span><span class="p">][</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">rel_error</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">err</span> <span class="o">=</span> <span class="n">err</span> <span class="o">/</span> <span class="n">r_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                        <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="n">errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span>
            <span class="n">sym_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">sym_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sym_error</span> <span class="o">=</span> <span class="n">sym_error</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_error</span></div>


<div class="viewcode-block" id="Condition.calc_symmetry_area_avg">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_symmetry_area_avg">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_symmetry_area_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">sym_type</span><span class="o">=</span><span class="s1">&#39;sym_half&#39;</span><span class="p">,</span> <span class="n">rel_error</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">even_opt</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the symmetry error</span>

<span class="sd">        Not sure this is necessary, could use :meth:`~MARIGOLD.Condition.Condition.calc_symmetry` and :meth:`~MARIGOLD.Condition.Condition.area_avg` to achieve a similar thing</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``sym_type``: _description_. Defaults to &#39;sym_half&#39;.</span>
<span class="sd">         - ``rel_error``: _description_. Defaults to True.</span>
<span class="sd">         - ``even_opt``: _description_. Defaults to &#39;first&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">         - ``ValueError``: _description_</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">sym_type</span> <span class="o">!=</span> <span class="s1">&#39;sym_half&#39;</span><span class="p">:</span>
           <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This function is only designed for &#39;sym_half&#39; symmetry type.&quot;</span><span class="p">)</span>

         <span class="c1"># Define angle pairs for left-right half symmetry</span>
        <span class="n">angle_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">(</span><span class="mf">22.5</span><span class="p">,</span> <span class="mf">202.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">225</span><span class="p">),</span> <span class="p">(</span><span class="mf">67.5</span><span class="p">,</span> <span class="mf">247.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">),</span> <span class="p">(</span><span class="mf">292.5</span><span class="p">,</span> <span class="mf">112.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">315</span><span class="p">,</span> <span class="mi">135</span><span class="p">),</span> <span class="p">(</span><span class="mf">337.5</span><span class="p">,</span> <span class="mf">157.5</span><span class="p">)]</span>

        <span class="n">sym_errors</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># To store symmetry errors for each angle pair</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># To store areas for weighted integration</span>

         <span class="c1"># Iterate over angle pairs</span>
        <span class="k">for</span> <span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span> <span class="ow">in</span> <span class="n">angle_pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">angle2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip if angles are not in the data</span>

            <span class="n">param_r</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># To store the radial integration result</span>
            <span class="n">rs_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Radial positions to integrate over</span>
            
            <span class="c1"># Calculate symmetry error for each radial position</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle1</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                  <span class="n">sym_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle2</span><span class="p">][</span><span class="n">rstar</span><span class="p">][</span><span class="n">param</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                   <span class="k">continue</span>  <span class="c1"># Skip if data is missing for the corresponding rstar in angle2</span>

                <span class="k">if</span> <span class="n">rel_error</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                       <span class="n">sym_error</span> <span class="o">/=</span> <span class="n">r_dict</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>  <span class="c1"># Calculate relative error</span>
                    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                       <span class="n">sym_error</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Handle division by zero case</span>
            
                <span class="n">rs_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span>
                <span class="n">param_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">sym_error</span><span class="p">)</span> <span class="o">*</span> <span class="n">rstar</span><span class="p">)</span>  <span class="c1"># Multiply by rstar for radial area weighting</span>

            <span class="c1"># Sort by radial position for integration</span>
            <span class="n">param_r_sorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs_list</span><span class="p">,</span> <span class="n">param_r</span><span class="p">))]</span>
            <span class="n">rs_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs_list</span><span class="p">)</span>
            
            <span class="c1"># Integrate wrt r (radial direction) using simpson&#39;s rule</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rs_sorted</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">radial_avg_sym</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">param_r_sorted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">rs_sorted</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Integration error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">radial_avg_sym</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">radial_avg_sym</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">sym_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radial_avg_sym</span><span class="p">)</span>
            <span class="n">areas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># For now, give equal weighting to all angles</span>

            <span class="c1"># Now integrate over angles (θ)</span>
        <span class="n">angles_in_radians</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="k">for</span> <span class="n">angle_pair</span> <span class="ow">in</span> <span class="n">angle_pairs</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym_errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="c1"># Final integration wrt angle θ</span>
              <span class="n">area_avg_sym_error</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">simpson</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">sym_errors</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">angles_in_radians</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angle integration error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">area_avg_sym_error</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">area_avg_sym_error</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">area_avg_sym_error</span></div>

    
<div class="viewcode-block" id="Condition.calc_vr_uncertainty">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_vr_uncertainty">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_vr_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma_vg</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">sigma_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma_dp</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">percentage</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to calculate the uncertainty in pitot-tube measurements</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``sigma_vg``: _description_. Defaults to 0.1.</span>
<span class="sd">         - ``sigma_alpha``: _description_. Defaults to 0.05.</span>
<span class="sd">         - ``sigma_dp``: _description_. Defaults to 0.03.</span>
<span class="sd">         - ``percentage``: are the preceeding . Defaults to True.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                <span class="n">dp</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;delta_p&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_vg</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_vg</span>

                <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_dp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_dp</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;delta_p&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_dp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_dp</span>

                <span class="k">if</span> <span class="n">percentage</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_alpha</span> <span class="o">*</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_alpha</span>
                
                <span class="k">if</span> <span class="n">dp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rho_f</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma_dp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">dp</span><span class="p">)</span>  <span class="o">+</span> <span class="n">sigma_alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vf&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;sigma_vg&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;sigma_vr&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Condition.calc_avg_lat_sep">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_avg_lat_sep">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_avg_lat_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates average lateral separation distance between bubbles</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - &quot;lambda&quot; in midas_dict</span>
<span class="sd">         - &quot;lambda*&quot; in midas_dict</span>
<span class="sd">         - &quot;alpha_lambda&quot; in midas_dict</span>

<span class="sd">        Returns:</span>
<span class="sd">         - Area-average :math:`\\lambda`</span>

<span class="sd">        Assuming</span>

<span class="sd">        .. math:: \\lambda = \\frac{v_g}{f}</span>

<span class="sd">        Where :math:`f` is the bubble frequency. Also estimates the void fraction based on this :math:`\\lambda`,</span>

<span class="sd">        .. math:: \\alpha = \\frac{D_{sm,1}}{\\lambda}</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ug1&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;bub_freq&#39;</span><span class="p">]</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;Dsm1&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span> <span class="o">/</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;lambda*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                    <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;lambda&#39;</span><span class="p">)</span></div>

    

<div class="viewcode-block" id="Condition.calc_COV_RC">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_COV_RC">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_COV_RC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_peak</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha_cr</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span> <span class="n">avg_method</span> <span class="o">=</span> <span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">reconstruct_flag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the experimental Random Collision Covariance based on Talley (2012) method (without modification factor m_RC)</span>
<span class="sd">         - Stored in self.COV_RC</span>
<span class="sd">         </span>
<span class="sd">         Inputs:</span>
<span class="sd">         - alpha_peak, maximum void fraction based on hexagonal-closed-packed (HCP) bubble distribution</span>
<span class="sd">         - alpha_cr, critical alpha to activate Random Collision, Talley (2012), Kong (2018) </span>
<span class="sd">        </span>
<span class="sd">         Authors:</span>
<span class="sd">         - Quan (05/15/2024)</span>
<span class="sd">         - Kang (08/19/2024)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">_________________________________________________________&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">                         COV_RC                          &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">jf = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="si">}</span><span class="s2">, jgref = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jgref</span><span class="si">}</span><span class="s2">, L/D = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Identical to calc_COV_TI</span>
        <span class="c1">########################################################################################################################</span>
        <span class="k">if</span> <span class="n">reconstruct_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">alpha_str</span> <span class="o">=</span> <span class="s1">&#39;alpha_reconstructed&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha_str</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span>

        <span class="c1"># Temporary, replace later</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">alpha_avg</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ai_avg</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>
        <span class="n">ai_avg</span>          <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ai_avg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># rho_f           = self.rho_f                                        # Liquid phase density [kg/m**3]</span>
        <span class="c1"># rho_g           = self.rho_g                                        # Gas phase density [kg/m**3]</span>
        <span class="c1"># mu_f            = self.mu_f                                         # Dynamic viscosity of water [Pa-s]</span>
        <span class="c1"># sigma           = self.sigma                                        # Surface tension</span>

        <span class="n">rho_f</span>           <span class="o">=</span> <span class="mi">998</span>                                                <span class="c1"># What Quan used</span>
        <span class="n">rho_g</span>           <span class="o">=</span> <span class="mf">1.226</span>                                              <span class="c1"># What Quan used</span>
        <span class="n">mu_f</span>            <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">sigma</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
        <span class="n">Dh</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span>                                           <span class="c1"># Hydraulic diameter [m]</span>
                
        <span class="n">rho_m</span>           <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho_f</span> <span class="o">+</span> <span class="n">alpha_avg</span> <span class="o">*</span> <span class="n">rho_g</span>       <span class="c1"># Mixture density</span>
        <span class="n">mu_m</span>            <span class="o">=</span> <span class="n">mu_f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span>                            <span class="c1"># Mixture viscosity</span>
        <span class="n">v_m</span>             <span class="o">=</span> <span class="p">(</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">+</span> <span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho_m</span>    <span class="c1"># Mixture velocity</span>
        <span class="c1"># Rem             = rho_m * v_m * Dh / mu_m                         # Mixture Reynolds number, ***CAREFUL*** I have seen some versions of the IATE script that use rho_f instead as an approximation</span>
        <span class="n">Rem</span>             <span class="o">=</span> <span class="n">rho_m</span> <span class="o">*</span> <span class="n">v_m</span> <span class="o">*</span> <span class="n">Dh</span> <span class="o">/</span> <span class="n">mu_f</span>                           <span class="c1"># Mixture Reynolds number, older versions use mu_f as an approximation</span>
        <span class="n">f_TP</span>            <span class="o">=</span> <span class="mf">0.316</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu_m</span> <span class="o">/</span> <span class="n">mu_f</span> <span class="o">/</span> <span class="n">Rem</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>                 <span class="c1"># Two-phase friction factor, Talley (2012) and Worosz (2015), also used in iate_1d_1g</span>
        <span class="n">eps</span>             <span class="o">=</span> <span class="n">f_TP</span> <span class="o">*</span> <span class="n">v_m</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Dh</span>                            <span class="c1"># Energy dissipation rate (Wu et al., 1998; Kim, 1999), also used in iate_1d_1g        </span>
        <span class="n">eps</span>             <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Switch away from using data</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">alpha_str</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>

        <span class="n">Dsm_exp</span>         <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">ai_avg</span>             <span class="c1"># for void re-construction method only </span>
        <span class="n">Dsm_exp</span>         <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Dsm_exp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">rho_m: </span><span class="si">{</span><span class="n">rho_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">mu_m: </span><span class="si">{</span><span class="n">mu_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">v_m: </span><span class="si">{</span><span class="n">v_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">Rem: </span><span class="si">{</span><span class="n">Rem</span><span class="si">}</span><span class="se">\t</span><span class="s2">f_TP: </span><span class="si">{</span><span class="n">f_TP</span><span class="si">}</span><span class="se">\t</span><span class="s2">eps: </span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Dsm_exp: </span><span class="si">{</span><span class="n">Dsm_exp</span><span class="si">}</span><span class="se">\t</span><span class="s2">alpha_str_avg: </span><span class="si">{</span><span class="n">alpha_avg</span><span class="si">}</span><span class="se">\t</span><span class="s2">ai_avg: </span><span class="si">{</span><span class="n">ai_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">alpha_loc</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">alpha_str</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">reconstruct_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">Db_loc</span> <span class="o">=</span> <span class="n">Dsm_exp</span>
                    <span class="c1"># ai_loc = ai_avg * alpha_loc / alpha_avg</span>
                    <span class="n">ai_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">Dsm_exp</span>

                    <span class="k">if</span> <span class="n">ai_loc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">ai_loc</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ai_loc</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ai&#39;</span><span class="p">]</span>
                    <span class="c1"># Db_loc = midas_dict[&#39;Dsm1&#39;] / 1000</span>
                    
                    <span class="k">if</span> <span class="n">ai_loc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">ai_loc</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="k">if</span> <span class="n">alpha_loc</span> <span class="o">&lt;=</span> <span class="n">alpha_cr</span><span class="p">:</span>                                   <span class="c1"># Check if local void fraction is less than or equal to alpha_cr</span>
                    <span class="n">u_t_loc</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">Db_loc</span><span class="p">)</span>              <span class="c1"># Turbulent velocity (Batchelor, 1951; Rotta, 1972), also used in iate_1d_1g</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">u_t_loc</span> <span class="o">=</span> <span class="mi">0</span>                                                 <span class="c1"># TI and RC are driven by the turbulent fluctuation velocity (u_t)</span>

                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;u_t_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_t_loc</span>     <span class="c1">#Quan, 1106</span>

                <span class="c1">########################################################################################################################</span>
                <span class="c1"># Talley 2012, section 3.3.1</span>
                <span class="n">COV_RC_loc</span> <span class="o">=</span> <span class="n">u_t_loc</span> <span class="o">*</span> <span class="n">ai_loc</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_loc</span><span class="p">)))</span>
                
                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;COV_RC_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">COV_RC_loc</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="c1"># print(f&quot;\t\t\t{angle:2.1f}\t{rstar:.2f}\t|\talpha: {alpha_loc:.4f}\tDbloc: {Db_loc:.4f}\tCOV_RC_loc: {COV_RC_loc:.4f}&quot;)</span>
                    <span class="k">pass</span>
                
        <span class="c1"># Talley does not area-average local u_t; instead computes &lt;u_t&gt; with area-averaged parameters</span>
        <span class="n">u_t_avg</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">ai_avg</span><span class="p">)</span>       
       <span class="c1"># u_t_avg = self.area_avg(&#39;u_t_loc&#39;, method=avg_method)   #Quan, 1106</span>

        <span class="k">if</span> <span class="n">u_t_avg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">COV_RC_avg</span> <span class="o">=</span> <span class="n">u_t_avg</span> <span class="o">*</span> <span class="n">ai_avg</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">alpha_avg</span><span class="p">)))</span>
            <span class="n">COV_RC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;COV_RC_loc&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span> <span class="o">/</span> <span class="n">COV_RC_avg</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t\t</span><span class="s2">u_t_avg: </span><span class="si">{</span><span class="n">u_t_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">COV_RC: </span><span class="si">{</span><span class="n">COV_RC</span><span class="si">}</span><span class="se">\t</span><span class="s2">COV_RC_num: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;COV_RC_loc&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">COV_RC_den: </span><span class="si">{</span><span class="n">COV_RC_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">COV_RC</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">COV_RC</span> <span class="o">=</span> <span class="n">COV_RC</span>

        <span class="k">return</span> <span class="n">COV_RC</span></div>



<div class="viewcode-block" id="Condition.calc_COV_TI">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.calc_COV_TI">[docs]</a>
    <span class="k">def</span> <span class="nf">calc_COV_TI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha_peak</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha_cr</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span> <span class="n">We_cr</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">avg_method</span> <span class="o">=</span> <span class="s1">&#39;legacy&#39;</span><span class="p">,</span> <span class="n">reconstruct_flag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">_________________________________________________________&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">                         COV_TI                          &quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">jf = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span><span class="si">}</span><span class="s2">, jgref = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jgref</span><span class="si">}</span><span class="s2">, L/D = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">LoverD</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Identical to calc_COV_RC</span>
        <span class="c1">########################################################################################################################</span>
        <span class="k">if</span> <span class="n">reconstruct_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">alpha_str</span> <span class="o">=</span> <span class="s1">&#39;alpha_reconstructed&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha_str</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span>

        <span class="c1"># Temporary, replace later</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">alpha_avg</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ai_avg</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>
        <span class="n">ai_avg</span>          <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ai_avg</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># rho_f           = self.rho_f                                        # Liquid phase density [kg/m**3]</span>
        <span class="c1"># rho_g           = self.rho_g                                        # Gas phase density [kg/m**3]</span>
        <span class="c1"># mu_f            = self.mu_f                                         # Dynamic viscosity of water [Pa-s]</span>
        <span class="c1"># sigma           = self.sigma                                        # Surface tension</span>

        <span class="n">rho_f</span>           <span class="o">=</span> <span class="mi">998</span>                                                <span class="c1"># What Quan used</span>
        <span class="n">rho_g</span>           <span class="o">=</span> <span class="mf">1.226</span>                                              <span class="c1"># What Quan used</span>
        <span class="n">mu_f</span>            <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">sigma</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
        <span class="n">Dh</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Dh</span>                                           <span class="c1"># Hydraulic diameter [m]</span>
                
        <span class="n">rho_m</span>           <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span> <span class="o">*</span> <span class="n">rho_f</span> <span class="o">+</span> <span class="n">alpha_avg</span> <span class="o">*</span> <span class="n">rho_g</span>       <span class="c1"># Mixture density</span>
        <span class="n">mu_m</span>            <span class="o">=</span> <span class="n">mu_f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha_avg</span><span class="p">)</span>                            <span class="c1"># Mixture viscosity</span>
        <span class="n">v_m</span>             <span class="o">=</span> <span class="p">(</span><span class="n">rho_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">+</span> <span class="n">rho_g</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho_m</span>    <span class="c1"># Mixture velocity</span>
        <span class="c1"># Rem             = rho_m * v_m * Dh / mu_m                           # Mixture Reynolds number, ***CAREFUL*** I have seen some versions of the IATE script that use rho_f instead as an approximation</span>
        <span class="n">Rem</span>             <span class="o">=</span> <span class="n">rho_m</span> <span class="o">*</span> <span class="n">v_m</span> <span class="o">*</span> <span class="n">Dh</span> <span class="o">/</span> <span class="n">mu_f</span>                           <span class="c1"># Mixture Reynolds number, older versions use mu_f as an approximation</span>
        <span class="n">f_TP</span>            <span class="o">=</span> <span class="mf">0.316</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu_m</span> <span class="o">/</span> <span class="n">mu_f</span> <span class="o">/</span> <span class="n">Rem</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>                 <span class="c1"># Two-phase friction factor, Talley (2012) and Worosz (2015), also used in iate_1d_1g</span>
        <span class="n">eps</span>             <span class="o">=</span> <span class="n">f_TP</span> <span class="o">*</span> <span class="n">v_m</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">Dh</span>                            <span class="c1"># Energy dissipation rate (Wu et al., 1998; Kim, 1999), also used in iate_1d_1g        </span>
        <span class="n">eps</span>             <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Switch away from using data</span>
        <span class="n">alpha_avg</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="n">alpha_str</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>

        <span class="n">Dsm_exp</span>         <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">ai_avg</span>
        <span class="n">Dsm_exp</span>         <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Dsm_exp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">rho_m: </span><span class="si">{</span><span class="n">rho_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">mu_m: </span><span class="si">{</span><span class="n">mu_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">v_m: </span><span class="si">{</span><span class="n">v_m</span><span class="si">}</span><span class="se">\t</span><span class="s2">Rem: </span><span class="si">{</span><span class="n">Rem</span><span class="si">}</span><span class="se">\t</span><span class="s2">f_TP: </span><span class="si">{</span><span class="n">f_TP</span><span class="si">}</span><span class="se">\t</span><span class="s2">eps: </span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2">Dsm_exp: </span><span class="si">{</span><span class="n">Dsm_exp</span><span class="si">}</span><span class="se">\t</span><span class="s2">alpha_str_avg: </span><span class="si">{</span><span class="n">alpha_avg</span><span class="si">}</span><span class="se">\t</span><span class="s2">ai_avg: </span><span class="si">{</span><span class="n">ai_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">alpha_loc</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="n">alpha_str</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">reconstruct_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">Db_loc</span> <span class="o">=</span> <span class="n">Dsm_exp</span>
                    <span class="c1"># ai_loc = ai_avg * alpha_loc / alpha_avg</span>
                    <span class="n">ai_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">Dsm_exp</span>

                    <span class="k">if</span> <span class="n">ai_loc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">ai_loc</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ai_loc</span> <span class="o">=</span> <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;ai&#39;</span><span class="p">]</span>
                    <span class="c1"># Db_loc = midas_dict[&#39;Dsm1&#39;] / 1000</span>
                    
                    <span class="k">if</span> <span class="n">ai_loc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_loc</span> <span class="o">/</span> <span class="n">ai_loc</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Db_loc</span> <span class="o">=</span> <span class="mi">0</span>
                
                <span class="k">if</span> <span class="n">alpha_loc</span> <span class="o">&lt;=</span> <span class="n">alpha_cr</span><span class="p">:</span>                                   <span class="c1"># Check if local void fraction is less than or equal to alpha_cr</span>
                    <span class="n">u_t_loc</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">Db_loc</span><span class="p">)</span>              <span class="c1"># Turbulent velocity (Batchelor, 1951; Rotta, 1972), also used in iate_1d_1g</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">u_t_loc</span> <span class="o">=</span> <span class="mi">0</span>                                                 <span class="c1"># TI and RC are driven by the turbulent fluctuation velocity (u_t)</span>

                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;u_t_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_t_loc</span>     <span class="c1">#Quan, 1106</span>

                <span class="c1">########################################################################################################################</span>
                <span class="n">We</span> <span class="o">=</span> <span class="n">rho_f</span> <span class="o">*</span> <span class="n">u_t_loc</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Db_loc</span> <span class="o">/</span> <span class="n">sigma</span>                        <span class="c1"># Weber number criterion</span>

                <span class="c1"># Talley 2012, section 3.3.1</span>
                <span class="k">if</span> <span class="n">We</span> <span class="o">&gt;=</span> <span class="n">We_cr</span><span class="p">:</span>
                    <span class="n">COV_TI_loc</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_t_loc</span> <span class="o">*</span> <span class="n">ai_loc</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha_loc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">We_cr</span> <span class="o">/</span> <span class="n">We</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">We_cr</span> <span class="o">/</span> <span class="n">We</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">COV_TI_loc</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;COV_TI_loc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">COV_TI_loc</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t\t\t</span><span class="si">{</span><span class="n">angle</span><span class="si">:</span><span class="s2">2.1f</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">rstar</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\t</span><span class="s2">|</span><span class="se">\t</span><span class="s2">alpha: </span><span class="si">{</span><span class="n">alpha_loc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">COV_TI_loc: </span><span class="si">{</span><span class="n">COV_TI_loc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">u_t: </span><span class="si">{</span><span class="n">u_t_loc</span><span class="si">}</span><span class="se">\t</span><span class="s2">We: </span><span class="si">{</span><span class="n">We</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>
        
        <span class="c1"># Talley does not area-average local u_t; instead computes &lt;u_t&gt; with area-averaged parameters</span>
        <span class="n">u_t_avg</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">ai_avg</span><span class="p">)</span>
       <span class="c1"># u_t_avg = self.area_avg(&#39;u_t_loc&#39;, method=avg_method)   #Quan, 1106</span>
        <span class="n">We_avg</span> <span class="o">=</span> <span class="n">rho_f</span> <span class="o">*</span> <span class="n">u_t_avg</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">alpha_avg</span> <span class="o">/</span> <span class="n">ai_avg</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>

        <span class="k">if</span> <span class="n">u_t_avg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">sqrt_term</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">We_cr</span> <span class="o">/</span> <span class="n">We_avg</span><span class="p">)</span>  <span class="c1">#Quan 1107</span>
            <span class="k">if</span> <span class="n">sqrt_term</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">COV_TI_avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_t_avg</span> <span class="o">*</span> <span class="n">ai_avg</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha_avg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt_term</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">We_cr</span> <span class="o">/</span> <span class="n">We_avg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">COV_TI_avg</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># or handle it in another way as needed</span>

           <span class="c1"># COV_TI_avg = (u_t_avg * ai_avg**2 / alpha_avg) * np.sqrt(1 - (We_cr / We_avg)) * np.exp(-We_cr / We_avg)</span>

            <span class="n">COV_TI_loc_avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;COV_TI_loc&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span>  <span class="c1">#Quan, 1107</span>
            <span class="k">if</span> <span class="n">COV_TI_avg</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">COV_TI_avg</span><span class="p">):</span>
                <span class="n">COV_TI</span> <span class="o">=</span> <span class="n">COV_TI_loc_avg</span> <span class="o">/</span> <span class="n">COV_TI_avg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">COV_TI</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># or handle this case as needed</span>

          <span class="c1">#  COV_TI = self.area_avg(&#39;COV_TI_loc&#39;,method=avg_method) / COV_TI_avg</span>
            
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t\t</span><span class="s2">u_t_avg: </span><span class="si">{</span><span class="n">u_t_avg</span><span class="si">}</span><span class="se">\t</span><span class="s2">We_avg: </span><span class="si">{</span><span class="n">We_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">COV_TI: </span><span class="si">{</span><span class="n">COV_TI</span><span class="si">}</span><span class="se">\t</span><span class="s2">COV_TI_num: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;COV_TI_loc&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">COV_TI_den: </span><span class="si">{</span><span class="n">COV_TI_avg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">COV_TI</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">COV_TI</span> <span class="o">=</span> <span class="n">COV_TI</span>

        <span class="k">return</span> <span class="n">COV_TI</span></div>

    
    
<div class="viewcode-block" id="Condition.reconstruct_void">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.reconstruct_void">[docs]</a>
    <span class="k">def</span> <span class="nf">reconstruct_void</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;talley&#39;</span><span class="p">,</span> <span class="n">avg_method</span> <span class="o">=</span> <span class="s1">&#39;legacy&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to reconstruct the void fraction profile by various means. </span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``method``: method to use to reconstruct void. Defaults to ``&#39;talley&#39;``. Options include:</span>
<span class="sd">             - ``&#39;talley&#39;``</span>
<span class="sd">             - ``&#39;not_talley&#39;``</span>
<span class="sd">             - ``&#39;ryan&#39;`` TODO, not implemented</span>
<span class="sd">             - ``&#39;adix&#39;``, TODO, not implemented</span>
<span class="sd">         - ``avg_method``: option passed to :func:`~MARIGOLD.Condition.Condition.area_avg`. Defaults to ``&#39;legacy&#39;``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">         - area-averaged reconstructed void </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;talley&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="mf">1.472e-5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ref</span> <span class="o">+</span> <span class="mf">2.571</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>      <span class="c1"># Inner r/R, outer end fixed at r/R = 1. Also, Talley rounds his r/R_end to the nearest 0.1</span>

            <span class="c1"># if debug:</span>
            <span class="c1">#     print(self.roverRend)</span>

            <span class="k">def</span> <span class="nf">lineq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">find_alpha_peak</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">,</span> <span class="n">rstar_peak</span><span class="o">=</span><span class="mf">0.90</span><span class="p">):</span>
                <span class="c1"># Talley&#39;s reconstruction has a finer grid than experimental data</span>
                <span class="c1"># This will affect the slope of the drop-off point if r/R_end is not coincident with a point on the experiment mesh</span>
                <span class="n">r_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_mesh_points</span><span class="p">(</span><span class="n">r_points</span><span class="p">)</span>

                <span class="n">interps</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>                 <span class="c1"># 360 degrees covered, not just one quadrant</span>
                    
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">interps</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;angle_nn&#39;</span><span class="p">:</span> <span class="n">angle_q1</span><span class="p">,</span> <span class="s1">&#39;m_nn&#39;</span><span class="p">:</span> <span class="n">m_i</span><span class="p">,</span> <span class="s1">&#39;x0_nn&#39;</span><span class="p">:</span> <span class="n">rstar_anchor</span><span class="p">,</span> <span class="s1">&#39;b_nn&#39;</span><span class="p">:</span> <span class="n">anchor</span><span class="p">}</span>

                    <span class="c1"># Operate in first quadrant</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">angle_q1</span> <span class="o">=</span> <span class="n">angle</span>
                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                        <span class="n">angle_q1</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="n">angle</span>
                    <span class="k">elif</span> <span class="n">angle</span> <span class="o">&lt;=</span> <span class="mi">270</span><span class="p">:</span>
                        <span class="n">angle_q1</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">-</span> <span class="mi">180</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">angle_q1</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">angle</span>

                    <span class="c1"># Save previous angle linear interpolations for nearest neighbor determination</span>
                    <span class="k">if</span> <span class="n">angle_q1</span> <span class="o">!=</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">angle_nn</span> <span class="o">=</span> <span class="n">interps</span><span class="p">[</span><span class="n">angle_q1</span><span class="p">][</span><span class="s1">&#39;angle_nn&#39;</span><span class="p">]</span>
                        <span class="n">m_nn</span> <span class="o">=</span> <span class="n">interps</span><span class="p">[</span><span class="n">angle_q1</span><span class="p">][</span><span class="s1">&#39;m_nn&#39;</span><span class="p">]</span>
                        <span class="n">x0_nn</span> <span class="o">=</span> <span class="n">interps</span><span class="p">[</span><span class="n">angle_q1</span><span class="p">][</span><span class="s1">&#39;x0_nn&#39;</span><span class="p">]</span>
                        <span class="n">b_nn</span> <span class="o">=</span> <span class="n">interps</span><span class="p">[</span><span class="n">angle_q1</span><span class="p">][</span><span class="s1">&#39;b_nn&#39;</span><span class="p">]</span>

                    <span class="c1"># Find the peak nearest neighbor</span>
                    <span class="k">if</span> <span class="n">angle_q1</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="c1"># For 90 degrees, just alpha_peak</span>
                        <span class="n">peak</span> <span class="o">=</span> <span class="n">alpha_peak</span>

                        <span class="n">anchor</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">rstar_anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span>

                    <span class="k">elif</span> <span class="n">angle_q1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># For 0 degrees, value at r/R = 0 along the 90 degree axis</span>
                        <span class="n">peak</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                     <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">alpha_peak</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">-</span> <span class="n">rstar_peak</span><span class="p">),</span>
                                     <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_peak</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="n">alpha_peak</span><span class="p">)</span>

                        <span class="n">anchor</span> <span class="o">=</span> <span class="n">peak</span>
                        <span class="n">rstar_anchor</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Find r* of previous angle at equivalent y-coordinate</span>
                        <span class="n">y_peak</span> <span class="o">=</span> <span class="n">rstar_peak</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_q1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                        <span class="n">rstar_nn</span> <span class="o">=</span> <span class="n">y_peak</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_nn</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>

                        <span class="c1"># if debug:</span>
                        <span class="c1">#     print(f&quot;angle: {angle}\tangle_nn: {angle_nn}&quot;)</span>

                        <span class="c1"># Peak void fraction of current angle defined as void fraction at previous angle r*</span>
                        <span class="n">peak</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rstar_nn</span><span class="p">,</span>
                                     <span class="n">m</span> <span class="o">=</span> <span class="n">m_nn</span><span class="p">,</span>
                                     <span class="n">x0</span> <span class="o">=</span> <span class="n">x0_nn</span><span class="p">,</span>
                                     <span class="n">b</span> <span class="o">=</span> <span class="n">b_nn</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">22.5</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_peak: </span><span class="si">{</span><span class="n">y_peak</span><span class="si">}</span><span class="se">\t</span><span class="s2">rstar_nn: </span><span class="si">{</span><span class="n">rstar_nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">pass</span>
                        
                        <span class="n">anchor</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">rstar_anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">90</span> <span class="o">-</span> <span class="n">angle_q1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>       <span class="c1"># Talley&#39;s implementation in Excel</span>
                        <span class="c1"># rstar_anchor = self.roverRend / np.sin(angle_q1 * np.pi / 180)            # But why not like this</span>
                        
                        <span class="c1"># if self.roverRend &gt; 0:</span>
                        <span class="c1">#     anchor = 0</span>
                        <span class="c1">#     rstar_anchor = self.roverRend</span>
                        <span class="c1"># else:</span>
                        <span class="c1">#     # Value at r/R = 0 along the 90 degree axis</span>
                        <span class="c1">#     anchor = lineq(x = 0,</span>
                        <span class="c1">#                    m = 0 - alpha_peak / (self.roverRend - rstar_peak),</span>
                        <span class="c1">#                    x0 = rstar_peak,</span>
                        <span class="c1">#                    b = alpha_peak)</span>
                        <span class="c1">#     rstar_anchor = 0</span>

                    <span class="c1"># Linear interpolation, y = mx + b</span>
                    <span class="n">m_o1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">peak</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rstar_peak</span><span class="p">)</span>                    <span class="c1"># Slope of outer interpolation</span>
                    <span class="n">m_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">peak</span> <span class="o">-</span> <span class="n">anchor</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rstar_peak</span> <span class="o">-</span> <span class="n">rstar_anchor</span><span class="p">)</span>     <span class="c1"># Slope of inner interpolation</span>

                    <span class="n">base</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">rstar_peak</span><span class="p">,</span>
                                 <span class="n">m</span> <span class="o">=</span> <span class="n">m_i</span><span class="p">,</span>
                                 <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_anchor</span><span class="p">,</span>
                                 <span class="n">b</span> <span class="o">=</span> <span class="n">anchor</span><span class="p">)</span>
                    <span class="n">rstar_base</span> <span class="o">=</span> <span class="o">-</span><span class="n">rstar_peak</span>

                    <span class="n">m_o2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rstar_base</span><span class="p">)</span>                   <span class="c1"># Slope of outer interpolation, on opposite wall</span>

                    <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>                <span class="c1"># Only goes from 0.0 to 1.0</span>

                        <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                            <span class="n">rstar</span> <span class="o">=</span> <span class="o">-</span><span class="n">rstar</span>                                  <span class="c1"># Use same slopes for -1.0 to 0.0</span>

                        <span class="c1"># Alpha interpolations in terms of r* (see page 134 of Talley 2012)</span>
                        <span class="k">if</span> <span class="n">rstar</span> <span class="o">&gt;</span> <span class="n">rstar_peak</span><span class="p">:</span>
                            <span class="c1"># Outer interpolation</span>
                            <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span><span class="p">,</span>
                                                                      <span class="n">m</span> <span class="o">=</span> <span class="n">m_o1</span><span class="p">,</span>
                                                                      <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_peak</span><span class="p">,</span>
                                                                      <span class="n">b</span> <span class="o">=</span> <span class="n">peak</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">rstar_peak</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">angle_q1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># Between peak locations, uniform profile</span>
                                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peak</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Inner interpolation</span>
                                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span><span class="p">,</span>
                                                                          <span class="n">m</span> <span class="o">=</span> <span class="n">m_i</span><span class="p">,</span>
                                                                          <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_anchor</span><span class="p">,</span>
                                                                          <span class="n">b</span> <span class="o">=</span> <span class="n">anchor</span><span class="p">)</span>
                                
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">angle_q1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># Symmetry for 180 degrees</span>
                                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span><span class="p">,</span>
                                                                          <span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">m_o1</span><span class="p">,</span>
                                                                          <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_peak</span><span class="p">,</span>
                                                                          <span class="n">b</span> <span class="o">=</span> <span class="n">peak</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Opposite wall interpolation</span>
                                <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lineq</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span><span class="p">,</span>
                                                                          <span class="n">m</span> <span class="o">=</span> <span class="n">m_o2</span><span class="p">,</span>
                                                                          <span class="n">x0</span> <span class="o">=</span> <span class="n">rstar_base</span><span class="p">,</span>
                                                                          <span class="n">b</span> <span class="o">=</span> <span class="n">base</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">:</span><span class="se">\t\t</span><span class="s2">alpha_rec: </span><span class="si">{</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\t</span><span class="s2">alpha_dat: </span><span class="si">{</span><span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak</span> <span class="o">=</span> <span class="n">alpha_peak</span>

                <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span> <span class="p">)</span>    <span class="c1"># Talley&#39;s value is to three decimals of precision</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">find_alpha_peak</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),))</span>      <span class="c1"># The way they want me to format bounds is stupid. Python is stupid.</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak_reconstructed</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
                <span class="n">find_alpha_peak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak_reconstructed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Minimization did not return a successful result&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">r/R_end: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">alpha_peak: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">⟨α⟩_data: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">⟨α⟩_reconstructed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">avg_method</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            def find_alpha_peak(alpha_peak):</span>
<span class="sd">                for angle, r_dict in self.data.items():</span>
<span class="sd">                    for rstar, midas_dict in r_dict.items():</span>

<span class="sd">                        x = rstar * np.cos(angle * np.pi / 180)</span>
<span class="sd">                        y = rstar * np.sin(angle * np.pi / 180)</span>

<span class="sd">                        # First calculate centerline void fraction (first linear interpolation)</span>
<span class="sd">                        if y &gt; 0.9:</span>
<span class="sd">                            alpha_CL = alpha_peak / 0.1 * (1 - y)</span>
<span class="sd">                        else:</span>
<span class="sd">                            alpha_CL = max(alpha_peak / (0.9 - self.roverRend) * (y - self.roverRend), 0) # make sure it&#39;s not &lt; 0. This covers for y &lt; roverRend</span>
<span class="sd">                        alpha_CL = float(alpha_CL)</span>

<span class="sd">                        # Then calculate</span>
<span class="sd">                        if rstar &gt;= 0.9:</span>
<span class="sd">                            xtrans = 0.9 * np.cos(angle * np.pi / 180)</span>
<span class="sd">                            midas_dict[&#39;alpha_reconstructed&#39;] = alpha_CL / (1 - xtrans) * (1-x)</span>
<span class="sd">                        else:</span>
<span class="sd">                            midas_dict[&#39;alpha_reconstructed&#39;] = alpha_CL</span>

<span class="sd">                return abs( self.area_avg(&#39;alpha&#39;) - self.area_avg(&#39;alpha_reconstructed&#39;) )</span>
<span class="sd">            </span>
<span class="sd">            result = minimize(find_alpha_peak, x0 = 0.5)</span>

<span class="sd">            if result.success:</span>
<span class="sd">                self.alpha_peak_reconstructed = result.x</span>
<span class="sd">                find_alpha_peak(self.alpha_peak_reconstructed)</span>
<span class="sd">            else:</span>
<span class="sd">                if debug:</span>
<span class="sd">                    warnings.warn(&quot;Minimization did not return a successful result&quot;)</span>
<span class="sd">                    print(f&quot;⟨α⟩_data: {self.area_avg(&#39;alpha&#39;)}\n⟨α⟩_reconstructed: {self.area_avg(&#39;alpha_reconstructed&#39;)}\n&quot;)</span>
<span class="sd">            &#39;&#39;&#39;</span>

        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;not_talley&#39;</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;double_linear&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.472e-5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ref</span> <span class="o">+</span> <span class="mf">2.571</span>

            <span class="k">def</span> <span class="nf">find_alpha_peak</span><span class="p">(</span><span class="n">alpha_peak</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                        <span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>

                        <span class="c1"># First calculate centerline void fraction (first linear interpolation)</span>
                        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
                            <span class="n">alpha_CL</span> <span class="o">=</span> <span class="n">alpha_peak</span> <span class="o">/</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">alpha_CL</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">alpha_peak</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">roverRend</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># make sure it&#39;s not &lt; 0. This covers for y &lt; roverRend</span>

                        <span class="c1"># </span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha_CL</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">))</span>

                <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">)</span> <span class="p">)</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">find_alpha_peak</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak_reconstructed</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
                <span class="n">find_alpha_peak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_peak_reconstructed</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Minimization did not return a successful result&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⟨α⟩_data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">⟨α⟩_reconstructed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ryan&#39;</span><span class="p">:</span>
            <span class="c1"># TODO</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;adix&#39;</span><span class="p">:</span>
            <span class="c1"># No fucking idea what this is</span>
            
            <span class="k">def</span> <span class="nf">complicated_alpha</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span>
                <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_dict</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

                        <span class="n">x</span> <span class="o">=</span> <span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">rstar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
                        <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span>
                        
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                        <span class="c1"># alpha = float(s * abs(np.sqrt(1-y**2) - abs(x))**(n) * np.sqrt(h) /sigma**2 * np.exp(-h**2 / (2*sigma**2)) )</span>
                        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span>  <span class="n">s</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">elif</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">midas_dict</span><span class="p">[</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">calc_errors</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">)</span>

                <span class="c1"># return (abs( self.area_avg(&#39;alpha&#39;) - self.area_avg(&#39;alpha_reconstructed&#39;) )/self.area_avg(&#39;alpha&#39;) + abs(self.max(&#39;alpha&#39;) - self.max(&#39;alpha_reconstructed&#39;)) / self.max(&#39;alpha&#39;)) * 100</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;eps_sq_alpha_alpha_reconstructed&#39;</span><span class="p">)</span>

                
            <span class="c1"># result = minimize(complicated_alpha, x0 = [0.2, 2, 0.3], method=&#39;Nelder-Mead&#39;, bounds=( (0.01, 1), (1, 100), (0.01, 10) ), options = {&#39;maxiter&#39;: 100000, &#39;disp&#39;: True}, tol = 1e-9)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">complicated_alpha</span><span class="p">,</span> <span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.041</span><span class="p">,</span> <span class="mf">0.1417</span><span class="p">,</span> <span class="mf">0.0155</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="p">),</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_s</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_n</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_sigma</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">complicated_alpha</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Minimization did not return a successful result&quot;</span><span class="p">)</span>
                    <span class="n">complicated_alpha</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⟨α⟩_data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">⟨α⟩_reconstructed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s1">&#39;alpha_reconstructed&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">area_avg</span><span class="p">(</span><span class="s2">&quot;alpha_reconstructed&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Condition.plot_profiles2">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_profiles2">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_profiles2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;vals&#39;</span><span class="p">,</span> <span class="n">errorbars</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                      <span class="n">const_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mf">67.5</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">include_complement</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">skip_1_comp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">fs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend_loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">xlabel_loc</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">include_const</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">set_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_spines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">xlabel_loc_coords</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ylabel_loc_coords</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Line plots of params</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options. Can be a single string, or a list of ``param`` strings.</span>
<span class="sd">         - ``save_dir``: directory in which to save the .png file. Will not save the file unless show = False. Defaults to &#39;.&#39;.</span>
<span class="sd">         - ``show``: display the figure (in an iPython notebook or have it pop up). Defaults to True.</span>
<span class="sd">         - ``x_axis``: the variable to put on the x-axis. Usually for vertical flow this is ``&#39;rs&#39;``, for horizontal, ``&#39;vals&#39;``. Also can be &#39;phis&#39;. Defaults to &#39;vals&#39;.</span>
<span class="sd">         - ``errorbars``: percentage errorbars to include. Can also specify ``&#39;sigma&#39;`` if you know what you&#39;re doing. Defaults to False.</span>
<span class="sd">         - ``const_to_plot``: a list of angles (if x-axis is &#39;vals&#39; or &#39;rs&#39;) or rs (if x-axis is &#39;phis&#39;). Defaults to [90, 67.5, 45, 22.5, 0].</span>
<span class="sd">         - ``include_complement``: includes the complementary angle of the const_to_plot (i.e. 270 with 90). Defaults to True.</span>
<span class="sd">         - ``skip_1_comp``: skip the r/R=1.0 value for the complementary angle. Useful for not having an ugly line interpolated down to 0 for r/R=1 if the data actually stops at something like r/R=-0.2. Defaults to False.</span>
<span class="sd">         - ``fig_size``: figure size tuple, in inches. Defaults to (4,4).</span>
<span class="sd">         - ``fs``: font size. Defaults to 10.</span>
<span class="sd">         - ``title``: option to display title. Defaults to True.</span>
<span class="sd">         - ``label_str``: param-axis label. Defaults to param name.</span>
<span class="sd">         - ``legend_loc``: option passed to ``plt.legend``. Defaults to &#39;best&#39;.</span>
<span class="sd">         - ``xlabel_loc``: option passed to ``plt.legend``. Defaults to &#39;center&#39;.</span>
<span class="sd">         - ``include_const``: Includes the constant angle in the plot legend. Defaults to False.</span>
<span class="sd">         - ``set_min``: minimum value for plot. If not specified, based on the data.</span>
<span class="sd">         - ``set_max``: maximum value for plot. If not specified, based on the data.</span>
<span class="sd">         - ``show_spines``: draw a box around the plot. Defaults to True.</span>
<span class="sd">         - ``xlabel_loc_coords``: coordinates to move the xlabel to. Defaults to None.</span>
<span class="sd">         - ``ylabel_loc_coords``: coordinates to move the ylabel to. Defaults to None.</span>
<span class="sd">         - ``cs``: colors to passed to ``plt.plot``. Can be a single value or list. If a list, will cycle through. Defaults to None.</span>
<span class="sd">         - ``ms``: marker style to passed to ``plt.plot``. Can be a single value or list. If a list, will cycle through. Defaults to None.</span>
<span class="sd">         - ``ls``: line style to passed to ``plt.plot``. Can be a single value or list. If a list, will cycle through. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO rewrite so it always loops over a list of params. If there&#39;s only one, just put it in a list at the begininng </span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;compressed&#39;</span><span class="p">)</span>

        <span class="c1"># Only show ticks on the left and bottom spines</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="c1"># Tick marks facing in</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">errorbars</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">errorbars</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2">% error bars&quot;</span><span class="p">)</span> <span class="c1"># dummy to just get this text in the legend</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ms</span><span class="p">:</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">marker_cycle</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">marker_cycle</span><span class="p">(</span><span class="n">marker_list</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ls</span><span class="p">:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="n">line_cycle</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="n">line_cycle</span><span class="p">(</span><span class="n">line_list</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">(</span><span class="n">color_list</span><span class="o">=</span> <span class="n">cs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">(</span><span class="n">set_color</span> <span class="o">=</span> <span class="n">param</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">set_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">mins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">specific_param</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">specific_param</span><span class="p">))</span>

            <span class="n">set_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">set_max</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">set_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.1</span>

        <span class="k">elif</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">maxs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">specific_param</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">maxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">specific_param</span><span class="p">))</span>

            <span class="n">set_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxs</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.1</span>

        <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span> <span class="ow">or</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">const_to_plot</span><span class="p">:</span>
                <span class="n">r_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">errs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vr&#39;</span><span class="p">:</span>
                                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="s1">&#39;sigma_vr&#39;</span><span class="p">])</span>
                            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vf&#39;</span><span class="p">:</span>
                                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="s1">&#39;sigma_vf&#39;</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;issue with sigma, assuming 0 error&#39;</span><span class="p">)</span>
                                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">*</span><span class="n">errorbars</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">specific_param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">specific_param</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">specific_param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">include_complement</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Cannot find complement to angle &gt; 180. Skipping&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="o">+</span><span class="mi">180</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">skip_1_comp</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
                                <span class="c1"># print(&#39;skipping&#39;)</span>
                                <span class="k">continue</span>
                            
                            <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                                <span class="k">except</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vr&#39;</span><span class="p">:</span>
                                        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="s1">&#39;sigma_vr&#39;</span><span class="p">])</span>
                                    <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vf&#39;</span><span class="p">:</span>
                                        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="s1">&#39;sigma_vf&#39;</span><span class="p">])</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;issue with sigma, assuming 0 error&#39;</span><span class="p">)</span>
                                        <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                                    <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">*</span><span class="n">errorbars</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            
                            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">specific_param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">specific_param</span><span class="p">])</span>
                                    <span class="k">except</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">specific_param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">vals</span><span class="p">))]</span>
                    <span class="n">errs</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">errs</span><span class="p">))]</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>

                    <span class="c1"># errs = errorbars * np.abs(np.asarray(vals))</span>

                    <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">xerr</span> <span class="o">=</span> <span class="n">errs</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">errs</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">vals_list</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                        <span class="n">temp_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">vals_list</span><span class="p">))]</span>
                        <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_list</span><span class="p">)</span>
                    <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">specific_param</span><span class="p">,</span> <span class="n">val_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
                        <span class="n">errs</span> <span class="o">=</span> <span class="n">errorbars</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val_list</span><span class="p">))</span>
                        <span class="c1"># print(val_list)</span>
                        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
                            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">(</span><span class="n">set_color</span> <span class="o">=</span> <span class="n">specific_param</span><span class="p">)</span>
                        
                        
                        <span class="n">legend_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">specific_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\alpha$&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s1">&#39;ai&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">specific_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$a_</span><span class="si">{i}</span><span class="s1">$&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s1">&#39;ug1&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">specific_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ug1&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{g}</span><span class="s1">$&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s1">&#39;vf&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">specific_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;vf&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{f}</span><span class="s1">$&#39;</span><span class="p">)</span>
                            
                            <span class="k">elif</span> <span class="n">specific_param</span> <span class="o">==</span> <span class="s1">&#39;vr&#39;</span><span class="p">:</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{r, G1}$&#39;</span>
                            <span class="k">elif</span> <span class="n">specific_param</span> <span class="o">==</span> <span class="s1">&#39;vr2&#39;</span><span class="p">:</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{r, G2}$&#39;</span>
                            <span class="k">elif</span> <span class="n">specific_param</span> <span class="o">==</span> <span class="s1">&#39;Dsm1&#39;</span><span class="p">:</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$D_</span><span class="si">{sm1}</span><span class="s1">$&#39;</span>
                            <span class="k">elif</span> <span class="n">specific_param</span> <span class="o">==</span> <span class="s1">&#39;Dsm2&#39;</span><span class="p">:</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$D_</span><span class="si">{sm2}</span><span class="s1">$&#39;</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;ug1&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">split_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="s1">&#39;v&#39;</span> <span class="o">+</span> <span class="s1">&#39;_{g, &#39;</span> <span class="o">+</span> <span class="n">split_param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>
                            <span class="k">elif</span> <span class="s1">&#39;vf&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">split_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="s1">&#39;v&#39;</span> <span class="o">+</span> <span class="s1">&#39;_{f, &#39;</span> <span class="o">+</span> <span class="n">split_param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>
                            <span class="k">elif</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">specific_param</span><span class="p">:</span>
                                <span class="n">split_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\alpha&#39;</span> <span class="o">+</span> <span class="s1">&#39;_{&#39;</span> <span class="o">+</span> <span class="n">split_param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">split_param</span> <span class="o">=</span> <span class="n">specific_param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                                <span class="n">legend_str</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span> <span class="o">+</span> <span class="n">split_param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_{&#39;</span> <span class="o">+</span> <span class="n">split_param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>

                        <span class="k">if</span> <span class="n">specific_param</span> <span class="o">==</span> <span class="s1">&#39;vg_approx&#39;</span><span class="p">:</span>
                            <span class="n">legend_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{g, model}$&#39;</span>

                        <span class="k">if</span> <span class="n">legend_str</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">legend_str</span> <span class="o">=</span> <span class="n">specific_param</span>

                        <span class="k">if</span> <span class="n">include_const</span><span class="p">:</span>
                            <span class="n">legend_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">°&quot;</span>

                        <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">legend_str</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">val_list</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">xerr</span> <span class="o">=</span> <span class="n">errs</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">legend_str</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">errorbars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span> <span class="ow">and</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">errorbars</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">legend_str</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">val_list</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">errs</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ecolor</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">legend_str</span><span class="p">)</span>
                    
            
            <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
            
        
        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$r/R$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rtarget</span> <span class="ow">in</span> <span class="n">const_to_plot</span><span class="p">:</span>
                <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span> <span class="o">-</span> <span class="n">rtarget</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                            <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">vals</span><span class="p">))]</span>
                <span class="n">phis</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rtarget</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid axis for plot_profiles: </span><span class="si">{</span><span class="n">x_axis</span><span class="si">}</span><span class="s2">. Current supported options are &#39;rs&#39;, &#39;vals&#39; and &#39;phi&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">label_str</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\alpha\ [-]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ai&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$a_</span><span class="si">{i}</span><span class="s1">\ [1/m]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ug1&#39;</span> <span class="ow">or</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ug2&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{g}</span><span class="s1">\ [m/s]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vf&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{f}</span><span class="s1">\ [m/s]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vr&#39;</span> <span class="ow">or</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;vr2&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{r}</span><span class="s1">\ [m/s]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;Dsm1&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$D_</span><span class="si">{sm1}</span><span class="s1">\ [mm]$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="n">param</span>
        
        <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">set_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">set_min</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="c1"># ax.yaxis.tick_right()</span>
                <span class="c1"># ax.yaxis.set_label_position(&quot;right&quot;)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">show_spines</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;rs&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">set_min</span><span class="p">)))</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">show_spines</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
            
        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\varphi$ [-]&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">])</span>
               
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
            <span class="c1"># Set your own title! -DHK</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        
        

        <span class="n">leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlabel_loc_coords</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">*</span><span class="n">xlabel_loc_coords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylabel_loc_coords</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">*</span><span class="n">ylabel_loc_coords</span><span class="p">)</span>


        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#fake_ax.set_box_aspect(1)</span>
        
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">_profile_vs_</span><span class="si">{</span><span class="n">x_axis</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="si">}</span><span class="s1">_profile_vs_</span><span class="si">{</span><span class="n">x_axis</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Condition.plot_profiles">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_profiles">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;vals&#39;</span><span class="p">,</span> 
                      <span class="n">const_to_plot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mf">67.5</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mf">22.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">include_complement</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">rotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend_loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">xlabel_loc</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
                      <span class="n">set_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show_spines</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">force_RH_y_axis</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">xlabel_loc_coords</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Line plot of ``param``. Only a single ``param`` can be plotted at a time, but plot can be arbitrarily rotated. </span>

<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``save_dir``: _description_. Defaults to &#39;.&#39;.</span>
<span class="sd">         - ``show``: _description_. Defaults to True.</span>
<span class="sd">         - ``x_axis``: _description_. Defaults to &#39;vals&#39;.</span>
<span class="sd">         - ``const_to_plot``: _description_. Defaults to [90, 67.5, 45, 22.5, 0].</span>
<span class="sd">         - ``include_complement``: _description_. Defaults to True.</span>
<span class="sd">         - ``rotate``: _description_. Defaults to False.</span>
<span class="sd">         - ``fig_size``: _description_. Defaults to (4,4).</span>
<span class="sd">         - ``title``: _description_. Defaults to True.</span>
<span class="sd">         - ``label_str``: _description_. Defaults to &#39;&#39;.</span>
<span class="sd">         - ``legend_loc``: _description_. Defaults to &#39;best&#39;.</span>
<span class="sd">         - ``xlabel_loc``: _description_. Defaults to &#39;center&#39;.</span>
<span class="sd">         - ``set_min``: _description_. Defaults to None.</span>
<span class="sd">         - ``set_max``: _description_. Defaults to None.</span>
<span class="sd">         - ``show_spines``: _description_. Defaults to True.</span>
<span class="sd">         - ``force_RH_y_axis``: _description_. Defaults to False.</span>
<span class="sd">         - ``xlabel_loc_coords``: _description_. Defaults to None.</span>
<span class="sd">         - ``cs``: _description_. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>

        <span class="n">log_x</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># This breaks, so I removed it from the arguments to the function</span>

        

        <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>

            <span class="c1"># Set up the figure to be rotated by theta</span>
            <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
            <span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
            <span class="kn">import</span> <span class="nn">mpl_toolkits.axisartist.floating_axes</span> <span class="k">as</span> <span class="nn">floating_axes</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                <span class="n">plot_extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="mf">1.1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">)),</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_extents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fig_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="mf">1.1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">)),</span> <span class="n">fig_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">rotate_deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            
            
            <span class="n">helper</span> <span class="o">=</span> <span class="n">floating_axes</span><span class="o">.</span><span class="n">GridHelperCurveLinear</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">plot_extents</span><span class="p">)</span>
            <span class="n">fake_ax</span> <span class="o">=</span> <span class="n">floating_axes</span><span class="o">.</span><span class="n">FloatingSubplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="n">grid_helper</span><span class="o">=</span><span class="n">helper</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fake_ax</span><span class="o">.</span><span class="n">get_aux_axes</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;compressed&#39;</span><span class="p">)</span>
            <span class="n">fake_ax</span> <span class="o">=</span> <span class="n">ax</span>

        <span class="c1"># Only show ticks on the left and bottom spines</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="c1"># Tick marks facing in</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

        <span class="n">ms</span> <span class="o">=</span> <span class="n">marker_cycle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;infer&#39;</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">color_cycle</span><span class="p">(</span><span class="n">set_color</span> <span class="o">=</span> <span class="n">param</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I hope cs is a generator that returns valid colors&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">set_max</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.1</span>

        <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span> <span class="ow">or</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">const_to_plot</span><span class="p">:</span>
                <span class="n">r_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">include_complement</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Cannot find complement to angle &gt; 180. Skipping&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">angle</span><span class="o">+</span><span class="mi">180</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">vals</span><span class="p">))]</span>
                <span class="n">rs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s1">°&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
            
        
        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$r/R$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rtarget</span> <span class="ow">in</span> <span class="n">const_to_plot</span><span class="p">:</span>
                <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">rstar</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span> <span class="o">-</span> <span class="n">rtarget</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
                            <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rstar</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">rstar</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">vals</span><span class="p">))]</span>
                <span class="n">phis</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">phis</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rtarget</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rtarget</span><span class="si">:</span><span class="s1">0.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">cs</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">next</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid axis for plot_profiles: </span><span class="si">{</span><span class="n">x_axis</span><span class="si">}</span><span class="s2">. Current supported options are &#39;r&#39; and &#39;phi&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">label_str</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\alpha\ [-]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ai&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$a_</span><span class="si">{i}</span><span class="s1">\ [1/m]$&#39;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ug1&#39;</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{g}</span><span class="s1">\ [m/s]$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_str</span> <span class="o">=</span> <span class="n">param</span>
        
        <span class="k">if</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;vals&#39;</span><span class="p">:</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
            <span class="c1">#fake_ax.set_xticks(np.linspace(self.min(param), self.max(param), 7))</span>

        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$r/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">x_axis</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rotate</span><span class="p">:</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\varphi$ [-]&#39;</span><span class="p">)</span>

                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">])</span>
                <span class="c1">#fake_ax.set_yticks(np.linspace(self.min(param), self.max(param), 7))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">xlabel_loc</span><span class="p">)</span>
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\varphi$ [-]&#39;</span><span class="p">)</span>
                
                <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">])</span>
                <span class="c1"># fake_ax.set_xticks(np.linspace(self.min(param), self.max(param), 7))</span>

                <span class="c1">#fake_ax.tick_params(axis=&#39;both&#39;, labelrotation=-self.theta)</span>
        
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">set_max</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">force_RH_y_axis</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">set_min</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">tick_right</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_spines</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">log_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">nonzero</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="o">*</span><span class="mf">1.2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">rotate</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">fake_ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlabel_loc_coords</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">*</span><span class="n">xlabel_loc_coords</span><span class="p">)</span>

        <span class="n">fake_ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;datalim&#39;</span><span class="p">,</span> <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#fake_ax.set_box_aspect(1)</span>
        
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">_profile_vs_</span><span class="si">{</span><span class="n">x_axis</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>   </div>


<div class="viewcode-block" id="Condition.plot_isoline">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_isoline">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_isoline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">iso_axis</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">iso_val</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">fig_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">plot_res</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
                     <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extra_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``iso_axis``: _description_</span>
<span class="sd">         - ``iso_val``: _description_</span>
<span class="sd">         - ``fig_size``: _description_. Defaults to 4.</span>
<span class="sd">         - ``plot_res``: _description_. Defaults to 100.</span>
<span class="sd">         - ``save_dir``: _description_. Defaults to &#39;.&#39;.</span>
<span class="sd">         - ``show``: _description_. Defaults to True.</span>
<span class="sd">         - ``extra_text``: _description_. Defaults to &#39;&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;compressed&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">iso_axis</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">iso_val</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lim</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">plot_res</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">iso_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ys</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="bp">self</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;linear_xy&#39;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">iso_axis</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">iso_val</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lim</span><span class="p">,</span> <span class="n">lim</span><span class="p">,</span> <span class="n">plot_res</span><span class="p">)</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">iso_val</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="bp">self</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;linear_xy&#39;</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker_color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_style</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">_iso_</span><span class="si">{</span><span class="n">iso_axis</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">iso_val</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extra_text</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Condition.plot_contour">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_contour">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">colorbar_label</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">suppress_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">rot_angle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ngridr</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">ngridphi</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;hot_r&#39;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level_step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">extra_save_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">annotate_h</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cartesian</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">h_star_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;max_dsm&#39;</span><span class="p">,</span> <span class="s1">&#39;min_void&#39;</span><span class="p">:</span> <span class="s1">&#39;0.05&#39;</span><span class="p">},</span> <span class="n">plot_measured_points</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">font_size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to create a contour plot of a given param</span>

<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``save_dir``: directory to save contour plot to. Defaults to &#39;.&#39;.</span>
<span class="sd">         - ``show``: whether or not to show the contour plot. Defaults to True.</span>
<span class="sd">         - ``set_max``: to specify the maximum value of the contour plot. If None, will caclulate based on data. Defaults to None.</span>
<span class="sd">         - ``set_min``: to specify the minimum value of the contour plot. If None, will caclulate based on data. Defaults to None.</span>
<span class="sd">         - ``fig_size``: size, in inches to make to figure square. Defaults to 4.</span>
<span class="sd">         - ``colorbar_label``: label to apply to the colorbar. Will default to the parameter name, with some common ones prettied up with LaTeX formatting. Defaults to None.</span>
<span class="sd">         - ``suppress_colorbar``: Don&#39;t include colorbar. Defaults to False.</span>
<span class="sd">         - ``rot_angle``: Rotate the contour plot by a specific angle (in degrees). Defaults to 0.</span>
<span class="sd">         - ``ngridr``: the number of interpolation points in the :math:`r` direction. Defaults to 50.</span>
<span class="sd">         - ``ngridphi``: the number of interpolation points in the :math:`\\varphi` direction. Defaults to 50.</span>
<span class="sd">         - ``colormap``: colormap to use for the contour plot. Defaults to &#39;hot_r&#39;.</span>
<span class="sd">         - ``num_levels``: number of levels for the contours. Defaults to 0.</span>
<span class="sd">         - ``level_step``: steps to define the number of contours. Not used if ``num_levels`` specified. Defaults to 0.01.</span>
<span class="sd">         - ``title``: title for the top of the plot. Default title is ``self.name``. Defaults to False.</span>
<span class="sd">         - ``title_str``: string to use as the title, if specified title will be set to True. Defaults to &#39;&#39;.</span>
<span class="sd">         - ``extra_save_text``: extra text to include while saving. Defaults to &#39;&#39;.</span>
<span class="sd">         - ``annotate_h``: draw a line where :math:`h` is calculated to be. Set ``cartestian=True`` for best results. Defaults to False.</span>
<span class="sd">         - ``cartesian``: plot in Cartesian coordinates. Defaults to False.</span>
<span class="sd">         - ``h_star_kwargs``: for annotate_h. Defaults to {&#39;method&#39;: &#39;max_dsm&#39;, &#39;min_void&#39;: &#39;0.05&#39;}.</span>
<span class="sd">         - ``plot_measured_points``: to plot red circles where the original data was measured (before mirroring). Defaults to False.</span>
<span class="sd">         - ``font_size``: font size. Defaults to 12.</span>

<span class="sd">        Returns:</span>
<span class="sd">         - ``ax``, the matplotlib axis the contour plot was made with</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="n">font_size</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>
        
        <span class="c1"># self.mirror()</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">phi_angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phi_angle</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">:</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">phi_angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting 0&quot;</span><span class="p">)</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phis</span><span class="p">)</span> <span class="o">+</span> <span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> 
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>   

        <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ngridr</span><span class="p">)</span>
        <span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rot_angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">rot_angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">,</span> <span class="n">ngridphi</span><span class="p">)</span>

        <span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span>
        <span class="n">interpolator</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">LinearTriInterpolator</span><span class="p">(</span> <span class="n">triang</span><span class="p">,</span> <span class="n">vals</span> <span class="p">)</span>

        <span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phii</span><span class="p">,</span> <span class="n">ri</span><span class="p">)</span>
        <span class="n">XI</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>
        <span class="n">YI</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>
        <span class="n">parami</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1"> to contour plot&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Xi</span><span class="p">,</span> <span class="n">Yi</span><span class="p">,</span> <span class="n">alphai</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">debugFID</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;max </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">alphai</span><span class="p">),</span> <span class="n">file</span> <span class="o">=</span> <span class="n">debugFID</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;contour_error_dump_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="c1">#print(vals)</span>
            <span class="k">raise</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Alpha exceeds 1.0!</span><span class="se">\n</span><span class="s1">Saving problematic array&#39;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Alpha exceeds 1.0!</span><span class="se">\n</span><span class="s1">Saving problematic array&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">extend_min</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">extend_max</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_max</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">parami</span><span class="p">):</span>
            <span class="n">extend_min</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">set_max</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parami</span><span class="p">):</span>
            <span class="n">extend_max</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">extend_max</span> <span class="ow">and</span> <span class="n">extend_min</span><span class="p">:</span>
            <span class="n">extend_opt</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
        <span class="k">elif</span> <span class="n">extend_min</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend_max</span> <span class="ow">and</span> <span class="n">set_min</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">parami</span><span class="p">):</span>
            <span class="n">extend_opt</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span>
        <span class="k">elif</span> <span class="n">extend_max</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend_min</span><span class="p">:</span>
            <span class="n">extend_opt</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">extend_min</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend_max</span><span class="p">:</span>
            <span class="n">extend_opt</span> <span class="o">=</span> <span class="s1">&#39;neither&#39;</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">level_step</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: Level step </span><span class="si">{</span><span class="n">level_step</span><span class="si">}</span><span class="s1"> too larger for range </span><span class="si">{</span><span class="n">set_max</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">set_min</span><span class="si">}</span><span class="s1">. Defaulting to 0.01*(set_max - set_min)&#39;</span><span class="p">)</span>
            <span class="n">level_step</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="p">(</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_levels</span><span class="p">:</span>
            <span class="n">lvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span><span class="p">,</span> <span class="n">num_levels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">set_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">):</span> <span class="c1"># if the max is 0, start the counting from there</span>
                <span class="n">lvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">set_max</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">set_min</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">level_step</span><span class="p">)</span>
                <span class="n">lvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lvs</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">level_step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">mpbl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="n">YI</span><span class="p">,</span> <span class="n">parami</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">lvs</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">set_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">set_max</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="c1"># Make a circle to look nice</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mpbl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span><span class="p">,</span> <span class="n">parami</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">lvs</span><span class="p">,</span> 
                               <span class="n">vmin</span> <span class="o">=</span> <span class="n">set_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">set_max</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="n">extend_opt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_measured_points</span><span class="p">:</span> 
                <span class="c1"># print(np.asarray(self.original_mesh)[:,0]* np.pi/180 , np.asarray(self.original_mesh)[:,1])</span>
                <span class="n">measured_thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">measured_rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">measured_rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">measured_rs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">measured_thetas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">measured_thetas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">measured_thetas</span><span class="p">,</span> <span class="n">measured_rs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">fillstyle</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotate_h</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cartesian</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: annotate_h assumes that we&#39;re plotting in Cartesian. Annotation may not be correct&quot;</span><span class="p">)</span>
            <span class="n">hstar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_hstar_pos</span><span class="p">(</span><span class="o">**</span><span class="n">h_star_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> 
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span>
                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>
        <span class="p">)</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="c1">#plt.clim(vmin=set_min, vmax=set_max)</span>
        
        <span class="k">if</span> <span class="n">colorbar_label</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_label</span> <span class="o">=</span> <span class="n">param</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                <span class="n">colorbar_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\alpha \ [-]$&quot;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ai&#39;</span><span class="p">:</span>
                <span class="n">colorbar_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$a_</span><span class="si">{i}</span><span class="s2"> \ [m^{-1}]$&quot;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;Dsm1&#39;</span><span class="p">:</span>
                <span class="n">colorbar_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$D_{sm,1} \ [mm]$&quot;</span>
            <span class="k">elif</span> <span class="n">param</span> <span class="o">==</span> <span class="s1">&#39;ug1&#39;</span><span class="p">:</span>
                <span class="n">colorbar_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$v_</span><span class="si">{g}</span><span class="s2"> \ [m/s]$&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">suppress_colorbar</span><span class="p">:</span>
            <span class="n">tx_step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))))</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span><span class="n">set_max</span><span class="p">,</span><span class="n">tx_step</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mpbl</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">colorbar_label</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">tx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title_str</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">title_str</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        
        <span class="c1">#cb = plt.colorbar(ticks = [0, 0.05, 0.1, 0.15, 0.2])</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">_contours_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">extra_save_text</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Condition.plot_surface">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_surface">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rotate_gif</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">elev_angle</span> <span class="o">=</span> <span class="mi">145</span><span class="p">,</span> 
                     <span class="n">azim_angle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">roll_angle</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ngridr</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">ngridphi</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                     <span class="n">plot_surface_kwargs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">solid_color</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">label_str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to create a 3 dimensional surface plot of a given parameter</span>
<span class="sd">        </span>
<span class="sd">        **Args:**</span>

<span class="sd">         - ``param``: ``midas_dict`` parameter to plot. See :func:`~MARIGOLD.Condition.print_params` for options</span>
<span class="sd">         - ``save_dir``: directory to save surface plot image to. Defaults to &#39;.&#39;.</span>
<span class="sd">         - ``show``: option to show surface plot. Defaults to True.</span>
<span class="sd">         - ``set_max``: option to set the maximum value of the surface plot. Defaults to None.</span>
<span class="sd">         - ``set_min``: option to set the minimum value of the surface plot. Defaults to None.</span>
<span class="sd">         - ``rotate_gif``: option to produce a .gif file where the surface plot rotates around. Defaults to False.</span>
<span class="sd">         - ``elev_angle``: elevation angle to rotate image of surface plot. Defaults to 145.</span>
<span class="sd">         - ``azim_angle``: azimuthal angle to rotate image of surface plot. Defaults to 0.</span>
<span class="sd">         - ``roll_angle``: roll angle to rotate image of surface plot. Defaults to 180.</span>
<span class="sd">         - ``title``: title of plot, if ``title_str`` is not set, will use. Defaults to True.</span>
<span class="sd">         - ``ngridr``: the number of interpolation points in the :math:`r` direction. Defaults to 50.</span>
<span class="sd">         - ``ngridphi``: the number of interpolation points in the :math:`\\varphi` direction. Defaults to 50.</span>
<span class="sd">         - ``plot_surface_kwargs``: dictionary to pass additional parameters to ``plot_surface``. Defaults to None.</span>
<span class="sd">         - ``solid_color``: use a solid color instead of a colormap. Defaults to False.</span>
<span class="sd">         - ``label_str``: custom label for z-axis. Defaults to None.</span>
<span class="sd">         - ``title_str``: title of surface plot. Defaults to &#39;&#39;.</span>
<span class="sd">         - ``colormap``: colormap to use for surface plot. Defaults to &#39;viridis&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">plot_surface_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_surface_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mirror</span><span class="p">()</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">phi_angle</span><span class="p">,</span> <span class="n">r_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">midas_output</span> <span class="ow">in</span> <span class="n">r_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="n">phis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phi_angle</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">midas_output</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> for φ = </span><span class="si">{</span><span class="n">phi_angle</span><span class="si">}</span><span class="s2">, r = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">. Substituting NaN&quot;</span><span class="p">)</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
        <span class="n">phis</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">phis</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> 
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>   

        <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ngridr</span><span class="p">)</span>
        <span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">ngridphi</span><span class="p">)</span>

        <span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">phis</span><span class="p">,</span> <span class="n">rs</span><span class="p">)</span>
        <span class="n">interpolator</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">LinearTriInterpolator</span><span class="p">(</span> <span class="n">triang</span><span class="p">,</span> <span class="n">vals</span> <span class="p">)</span>

        <span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phii</span><span class="p">,</span> <span class="n">ri</span><span class="p">)</span>
        <span class="n">parami</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span><span class="p">)</span>

        <span class="n">Xi</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>
        <span class="n">Yi</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">param</span><span class="p">)})</span>

        <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">param</span><span class="p">)})</span>

        <span class="k">if</span> <span class="s1">&#39;cmap&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">solid_color</span><span class="p">:</span> 
            <span class="n">plot_surface_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">colormap</span><span class="p">})</span>

        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">Xi</span><span class="p">,</span> <span class="n">Yi</span><span class="p">,</span> <span class="n">parami</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_surface_kwargs</span><span class="p">)</span>
        
        <span class="c1">#plt.legend()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/R$ [-]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y/R$ [-]&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">([</span><span class="n">plot_surface_kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">plot_surface_kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]])</span>
        
        <span class="k">if</span> <span class="n">set_min</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_max</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">parami</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="n">tx_step</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">set_max</span> <span class="o">-</span> <span class="n">set_min</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">))))</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">set_min</span><span class="p">,</span><span class="n">set_max</span><span class="p">,</span><span class="n">tx_step</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">label_str</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">label_str</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_str</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">tx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">param</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">tx</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">title_str</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">azim_angle</span><span class="p">,</span> <span class="n">roll</span><span class="o">=</span><span class="n">roll_angle</span><span class="p">,</span> <span class="n">elev</span><span class="o">=</span><span class="n">elev_angle</span><span class="p">)</span>
               
        <span class="c1">#cb = plt.colorbar(ticks = [0, 0.05, 0.1, 0.15, 0.2])</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">_surface_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">rotate_gif</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
            
            <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">azim</span><span class="o">=</span><span class="n">angle</span><span class="p">)</span>
            
            <span class="n">rot_animation</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">362</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">rot_animation</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">_surface_rotation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.gif&#39;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

        <span class="k">return</span></div>


<div class="viewcode-block" id="Condition.plot_spline_contour">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.plot_spline_contour">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_spline_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">save_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">set_max</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">set_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fig_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                     <span class="n">rot_angle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ngridr</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">ngridphi</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="s1">&#39;hot_r&#39;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                     <span class="n">annotate_h</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cartesian</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">h_star_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;max_dsm&#39;</span><span class="p">,</span> <span class="s1">&#39;min_void&#39;</span><span class="p">:</span> <span class="s1">&#39;0.05&#39;</span><span class="p">},</span>
                     <span class="n">grad</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a contour from a spline interpolation</span>

<span class="sd">        Will fit the spline if necessary. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2"> not found in spline_interp dict, running fit_spline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_spline</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">phii_arg</span> <span class="o">=</span> <span class="n">phii</span> <span class="o">+</span> <span class="n">rot_angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">fig_size</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm&quot;</span>

        <span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">phii</span><span class="p">,</span> <span class="n">ri</span><span class="p">)</span>
        <span class="n">XI</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>
        <span class="n">YI</span> <span class="o">=</span> <span class="n">RI</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">PHII</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span>  <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">RI</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;phinor&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="n">param</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">elif</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">VALS</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phii_arg</span><span class="p">)</span><span class="o">*</span><span class="n">ri</span> <span class="o">/</span> <span class="p">(</span><span class="n">ri</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">spline_interp</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">](</span><span class="n">phii_arg</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phii_arg</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: unrecognized grad type </span><span class="si">{</span><span class="n">grad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">XI</span><span class="p">,</span> <span class="n">YI</span><span class="p">,</span> <span class="n">VALS</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">num_levels</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">set_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">set_max</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="c1"># Make a circle to look nice</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">PHII</span><span class="p">,</span> <span class="n">RI</span><span class="p">,</span> <span class="n">VALS</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">num_levels</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">set_min</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">set_max</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">annotate_h</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cartesian</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: annotate_h assumes that we&#39;re plotting in Cartesian. Annotation may not be correct&quot;</span><span class="p">)</span>
            <span class="n">hstar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_hstar_pos</span><span class="p">(</span><span class="o">**</span><span class="n">h_star_kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> 
                    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span> 
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">hstar</span><span class="p">),</span>
                    <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>
        <span class="p">)</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cartesian</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y/R$ [-]&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="k">if</span> <span class="n">grad</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">param_label</span> <span class="o">=</span> <span class="n">param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_label</span> <span class="o">=</span> <span class="s2">&quot;grad_&quot;</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">grad</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">param_label</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        
        <span class="c1">#cb = plt.colorbar(ticks = [0, 0.05, 0.1, 0.15, 0.2])</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param_label</span><span class="si">}</span><span class="s2">_spline_contours_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="Condition.rough_FR_ID">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.rough_FR_ID">[docs]</a>
    <span class="k">def</span> <span class="nf">rough_FR_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the flow regime for the given condition, by some rough methods</span>

<span class="sd">        Inputs:</span>
<span class="sd">         - None</span>

<span class="sd">        Stores:</span>
<span class="sd">         - ``FR`` in self</span>

<span class="sd">        Returns:</span>
<span class="sd">         - FR</span>

<span class="sd">        First checks if it matches any given by previous researchers, or the hierarchical</span>
<span class="sd">        clustering algorithm results</span>

<span class="sd">        1 = bubbly</span>
<span class="sd">        2 = plug</span>
<span class="sd">        3 = slug</span>
<span class="sd">        4 = churn</span>
<span class="sd">        5 = stratified</span>
<span class="sd">        6 = stratified wavy</span>
<span class="sd">        7 = annular</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="c1"># These values are taken from the respective theses where the data comes from</span>
               
        <span class="n">drew_frid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.333</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>
            
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.333</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>

            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.333</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="c1">#I changed this, because the point was a consistent outlier</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>

            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.333</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>

            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>    <span class="mf">0.333</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span>  <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span>  <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>    <span class="mf">1.0</span><span class="p">,</span>   <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>    <span class="mf">0.33</span><span class="p">,</span>  <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">kong_frid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span>  <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.327</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span>   <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.297</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.189</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.332</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.329</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.040</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.799</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">1.030</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>

            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">0.105</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">0.167</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">0.327</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.00</span><span class="p">,</span> <span class="mf">0.089</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.00</span><span class="p">,</span> <span class="mf">0.149</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.00</span><span class="p">,</span> <span class="mf">0.297</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.00</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.00</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.00</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.330</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.50</span><span class="p">,</span> <span class="mf">0.332</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.00</span><span class="p">,</span> <span class="mf">0.327</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.507</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">3.000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">0.330</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">0.575</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">,</span> <span class="mf">3.000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">,</span> <span class="mf">0.330</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">talley_frid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> 
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># This one is taken from David&#39;s hierarchical clustering algorithm results</span>
        <span class="n">frid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">20.7</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">20.4</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">19.6</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">19.3</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">18.6</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">18.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">17.6</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">14.7</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.11</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">21.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">22.5</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">21.7</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">19.9</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">20.9</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">20.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">25.0</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">15.5</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  				  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">21.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">20.9</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">6.72</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">20.1</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">6.73</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">19.3</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">6.75</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">19.8</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">6.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">18.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">2.12</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">6.78</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">16.7</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">2.14</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">13.5</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">26.4</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">23.8</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">23.1</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">22.4</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">20.6</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">20.1</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">19.1</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">15.1</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">21.5</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">20.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">18.2</span>  <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>   
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">6</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.07</span>  <span class="p">,</span><span class="mi">5</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">0</span> <span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.24</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span>  <span class="p">,</span><span class="mi">2</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.76</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">7.81</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">17.99</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">2.44</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.13</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.43</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.36</span>  <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">4.37</span>  <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">13.98</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.04</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.048</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.158</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.531</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">1.719</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">5.541</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">17.66</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.047</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.159</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.538</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.729</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">5.577</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">17.57</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.047</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.161</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.537</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">1.724</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">5.562</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">17.39</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.047</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.158</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.536</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.725</span> <span class="p">,</span><span class="mi">3</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">5.564</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">17.36</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.047</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.051</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.051</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.82</span><span class="p">,</span> <span class="mf">0.048</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.046</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.127</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.209</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.372</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.131</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.136</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">20.74</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">9.870</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">20.50</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">9.899</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">21.75</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">9.916</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">22.60</span> <span class="p">,</span><span class="mi">7</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">9.941</span> <span class="p">,</span><span class="mi">4</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.186</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">4.00</span><span class="p">,</span> <span class="mf">0.33</span>  <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">2.50</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">),</span>  
            <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mf">1.56</span><span class="p">,</span> <span class="mf">0.111</span> <span class="p">,</span><span class="mi">1</span><span class="p">)</span> 
        <span class="p">]</span>


        <span class="k">for</span> <span class="n">theta_ID</span><span class="p">,</span> <span class="n">jf_ID</span><span class="p">,</span> <span class="n">jg_ID</span><span class="p">,</span> <span class="n">FR_ID</span> <span class="ow">in</span> <span class="n">drew_frid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="n">theta_ID</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">-</span> <span class="n">jf_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">-</span> <span class="n">jg_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="n">FR_ID</span>
                    <span class="k">return</span>

        <span class="k">for</span> <span class="n">theta_ID</span><span class="p">,</span> <span class="n">jf_ID</span><span class="p">,</span> <span class="n">jg_ID</span><span class="p">,</span> <span class="n">FR_ID</span> <span class="ow">in</span> <span class="n">kong_frid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="n">theta_ID</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">-</span> <span class="n">jf_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">-</span> <span class="n">jg_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="n">FR_ID</span>
                    <span class="k">return</span>

        <span class="k">for</span> <span class="n">theta_ID</span><span class="p">,</span> <span class="n">jf_ID</span><span class="p">,</span> <span class="n">jg_ID</span><span class="p">,</span> <span class="n">FR_ID</span> <span class="ow">in</span> <span class="n">talley_frid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="n">theta_ID</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">-</span> <span class="n">jf_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">-</span> <span class="n">jg_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="n">FR_ID</span>
                    <span class="k">return</span>
                
        <span class="k">for</span> <span class="n">theta_ID</span><span class="p">,</span> <span class="n">jf_ID</span><span class="p">,</span> <span class="n">jg_ID</span><span class="p">,</span> <span class="n">FR_ID</span> <span class="ow">in</span> <span class="n">frid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="n">theta_ID</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">-</span> <span class="n">jf_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">-</span> <span class="n">jg_ID</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="n">FR_ID</span>
                    <span class="k">return</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">&gt;</span> <span class="mf">3.4</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jgloc</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">jf</span> <span class="o">&lt;</span> <span class="mf">3.7</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FR</span> <span class="o">=</span> <span class="mi">2</span>
        
        <span class="c1">#print(f&quot;Warning: Flow regime not accurately identified for {self.name}, defaulting to {self.FR}&quot;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FR</span></div>


<div class="viewcode-block" id="Condition.TD_FR_ID">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.Condition.TD_FR_ID">[docs]</a>
    <span class="k">def</span> <span class="nf">TD_FR_ID</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; This function estimates the flow regime based on Taitel and Dukler&#39;s method</span>

<span class="sd">        Not implemented yet</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#dpdxL</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FR</span></div>
</div>



<div class="viewcode-block" id="print_tab_keys">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.print_tab_keys">[docs]</a>
<span class="k">def</span> <span class="nf">print_tab_keys</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alias of print_params()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">print_params</span><span class="p">()</span>
    <span class="k">return</span></div>


<div class="viewcode-block" id="print_params">
<a class="viewcode-back" href="../../MARIGOLD.html#MARIGOLD.Condition.print_params">[docs]</a>
<span class="k">def</span> <span class="nf">print_params</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convenience function in case you forget a parameter</span>
<span class="sd">     </span>
<span class="sd">    Generally, the available the available parameters are:</span>

<span class="sd">     - ``&#39;roverR&#39;``, nondimensional radial location</span>
<span class="sd">     - ``&#39;time&#39;``, measurement time</span>
<span class="sd">     - ``&#39;frequency&#39;``, data acquisition frequency</span>
<span class="sd">     - ``&#39;num_spherical&#39;``, number of spherical bubbles observed</span>
<span class="sd">     - ``&#39;num_distorted&#39;``, number of distorted bubbles observed</span>
<span class="sd">     - ``&#39;num_cap&#39;``, number of cap bubbles observed</span>
<span class="sd">     - ``&#39;num_slug&#39;``, number of slug bubbles observed</span>
<span class="sd">     - ``&#39;num_G1&#39;``, number of Group I bubbles observed</span>
<span class="sd">     - ``&#39;num_G2&#39;``, number of Group II bubbles observed</span>
<span class="sd">     - ``&#39;num_total&#39;``, total number of bubbles observed</span>
<span class="sd">     - ``&#39;obs_0&#39;``, number of bubbles observed at sensor 0</span>
<span class="sd">     - ``&#39;obs_1&#39;``, number of bubbles observed at sensor 1</span>
<span class="sd">     - ``&#39;obs_2&#39;``, number of bubbles observed at sensor 2</span>
<span class="sd">     - ``&#39;obs_3&#39;``, number of bubbles observed at sensor 3</span>
<span class="sd">     - ``&#39;bub_freq&#39;``, bubble freqency</span>
<span class="sd">     - ``&#39;pair_spherical&#39;``, number of spherical bubble signals paired</span>
<span class="sd">     - ``&#39;pair_distorted&#39;``, number of distorted bubble signals paired</span>
<span class="sd">     - ``&#39;pair_cap&#39;``, number of cap bubble signals paired</span>
<span class="sd">     - ``&#39;pair_slug&#39;``, number of slug bubble signals paired</span>
<span class="sd">     - ``&#39;total_paired&#39;``, total number bubble signals paired</span>
<span class="sd">     - ``&#39;percent_paired&#39;``, percentage of observed signals that were paired</span>
<span class="sd">     - ``&#39;alpha_spherical&#39;``, void fraction contribution from spherical bubbles</span>
<span class="sd">     - ``&#39;alpha_distorted&#39;``, void fraction contribution from distorted bubbles</span>
<span class="sd">     - ``&#39;alpha_cap&#39;``, void fraction contribution from cap bubbles</span>
<span class="sd">     - ``&#39;alpha_slug&#39;``, void fraction contribution from slug bubbles</span>
<span class="sd">     - ``&#39;alpha_G1&#39;``, void fraction contribution from Group I bubbles</span>
<span class="sd">     - ``&#39;alpha_G2&#39;``, void fraction contribution from Group II bubbles</span>
<span class="sd">     - ``&#39;alpha&#39;``, total void fraction </span>
<span class="sd">     - ``&#39;ai_spherical&#39;``, interfacial area concentration contribution from spherical bubbles</span>
<span class="sd">     - ``&#39;ai_distorted&#39;``, interfacial area concentration contribution from distorted bubbles</span>
<span class="sd">     - ``&#39;ai_cap&#39;``, interfacial area concentration contribution from cap bubbles</span>
<span class="sd">     - ``&#39;ai_slug&#39;``, interfacial area concentration contribution from slug bubbles</span>
<span class="sd">     - ``&#39;ai_G1&#39;``, interfacial area concentration contribution from Group I bubbles</span>
<span class="sd">     - ``&#39;ai_G2&#39;``, interfacial area concentration contribution from Group II bubbles</span>
<span class="sd">     - ``&#39;ai&#39;``, total interfacial area concentration :math:`[m^{-1}]`</span>
<span class="sd">     - ``&#39;Dsm1&#39;``, Sauter-mean diameter from Group I bubbles :math:`[mm]`</span>
<span class="sd">     - ``&#39;Lcl1&#39;``, chord length from Group I bubbles :math:`[mm]`</span>
<span class="sd">     - ``&#39;Dsm2&#39;``, Sauter-mean diameter from Group II bubbles :math:`[mm]`</span>
<span class="sd">     - ``&#39;Lcl2&#39;``, chord length from Group II bubbles :math:`[mm]`</span>
<span class="sd">     - ``&#39;ug1&#39;``, Average interface velocity from Group I bubbles :math:`[m/s]`</span>
<span class="sd">     - ``&#39;ug2&#39;``, Average interface velocity from Group II bubbles :math:`[m/s]`</span>
<span class="sd">     - ``&#39;sigma_ug1&#39;``, standard deviation of Group I bubble velocities (?) :math:`[m/s]`</span>
<span class="sd">     - ``&#39;sigma_ug2&#39;``, standard deviation of Group II bubble velocities (?) :math:`[m/s]`</span>
<span class="sd">     - ``&#39;fluctuation&#39;`` :math:`[m/s]`</span>
<span class="sd">     - ``&#39;alpha_ug1&#39;``, Local :math:`j_{g}` calculated by :math:`\\alpha` and Group I bubble velocity :math:`[m/s]`</span>
<span class="sd">     - ``&#39;alpha_ug2&#39;``, Local :math:`j_{g}` calculated by :math:`\\alpha` and Group II bubble velocity :math:`[m/s]`</span>
<span class="sd">     - ``&#39;alpha_ug&#39;``, Total local :math:`j_{g}` :math:`[m/s]`</span>
<span class="sd">     - ``&#39;alpha_Dsm1&#39;``, Product of alpha and :math:`D_{sm,1}` :math:`[mm]`</span>
<span class="sd">     - ``&#39;alpha_Dsm2&#39;``, Product of alpha and :math:`D_{sm,2}` :math:`[mm]`</span>
<span class="sd">     - ``&#39;r01&#39;``, distance between sensor 0 and 1 :math:`[mm]`</span>
<span class="sd">     - ``&#39;r02&#39;``, distance between sensor 0 and 2 :math:`[mm]`</span>
<span class="sd">     - ``&#39;r03&#39;``, distance between sensor 0 and 3 :math:`[mm]`</span>
<span class="sd">     - ``&#39;r12&#39;``, distance between sensor 1 and 2 :math:`[mm]`</span>
<span class="sd">     - ``&#39;r13&#39;``, distance between sensor 1 and 3 :math:`[mm]`</span>
<span class="sd">     - ``&#39;r23&#39;``, distance between sensor 2 and 3 :math:`[mm]`</span>
<span class="sd">     - ``&#39;vf&#39;``, liquid velocity :math:`[m/s]`</span>
<span class="sd">     - ``&#39;jf_loc&#39;``, local superficial liquid velocity :math:`[m/s]`</span>
<span class="sd">     - ``&#39;jf&#39;``, superficial liquid veloicty :math:`[m/s]`</span>
<span class="sd">     - ``&#39;delta_p&#39;``, pressure difference measured by Pitot-static probe :math:`[psi]`</span>
<span class="sd">     - ``&#39;sigma_delta_p&#39;``, standard deviation of pressure difference measured by Pitot-static probe :math:`[psi]`</span>
<span class="sd">     - ``&#39;vr&#39;``, relative velocity :math:`[m/s]`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">tab_keys</span><span class="p">)</span>
    <span class="k">return</span></div>


<span class="n">tab_keys</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;roverR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="s1">&#39;frequency&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_G1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_G2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_total&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bub_freq&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pair_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pair_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pair_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pair_slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total_paired&#39;</span><span class="p">,</span>
    <span class="s1">&#39;percent_paired&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_G1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_G2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_G1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_G2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dsm1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Lcl1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dsm2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Lcl2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ug1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ug2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sigma_ug1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sigma_ug2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fluctuation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_ug1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_ug2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_ug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_Dsm1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_Dsm2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r01&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r02&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r03&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r12&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r13&#39;</span><span class="p">,</span>
    <span class="s1">&#39;r23&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jf_loc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;delta_p&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sigma_delta_p&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vr&#39;</span>
<span class="p">]</span>

<span class="n">old_tab_keys</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;roverR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;time&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;num_total&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bub_freq&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;obs_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;total_paired&#39;</span><span class="p">,</span>
    <span class="s1">&#39;percent_paired&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_spherical&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_distorted&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai_cap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ai&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dsm1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dsm2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ug1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ug2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sigma_ug1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sigma_ug2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fluctuation_ug&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">zero_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">tab_keys</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">tab_keys</span><span class="p">)))</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, adix.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #EAA221;
    }
    /* Sidebar */
    .wy-body-for-nav, .wy-nav-side, .wy-grid-for-nav, .wy-nav-shift {
        background: #555960;
    }
    .wy-nav-content {
        background: #c4bfc0;
    }
  </style>


</body>
</html>